<?php
/*
 * @ https://EasyToYou.eu - IonCube v11 Decoder Online
 * @ PHP 5.6
 * @ Decoder version: 1.0.4
 * @ Release: 02/06/2020
 *
 * @ ZendGuard Decoder PHP 5.6
 */

// Decoded file for php version 53.
echo "<!DOCTYPE html>\r\n<!--\r\nTo change this license header, choose License Headers in Project Properties.\r\nTo change this template file, choose Tools | Templates\r\nand open the template in the editor.\r\n-->\r\n<html>\r\n    <head>\r\n        <title>";
echo $_SESSION["page_title"];
echo " PI</title>\r\n        <meta charset=\"UTF-8\">\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n        <link rel=\"icon\" type=\"image/png\" href=\"resources/favicon.png\">\r\n\r\n        <script src=\"libraries/jquery-3.1.1.min.js\" type=\"text/javascript\"></script>\r\n\r\n        <script src=\"libraries/bootstrap-3.3.7-dist/js/bootstrap.min.js\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-3.3.7-dist/css/bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"libraries/bootstrap-plugins/DataTables-1.10.13/media/js/jquery.dataTables.min.js\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/bootstrap-plugins/DataTables-1.10.13/media/js/dataTables.bootstrap.min.js\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-plugins/DataTables-1.10.13/media/css/dataTables.bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n\r\n            <link href=\"application/mvc/views/custom_libraries/css/select2.min.css?v=2\" rel=\"stylesheet\" type=\"text/css\" />\r\n    <script src=\"application/mvc/views/custom_libraries/javascripts/select2.full.min.js\" type=\"text/javascript\"></script>\r\n    \r\n        <script src=\"libraries/bootstrap-plugins/DataTables-1.10.13/extensions/Select/js/dataTables.select.min.js\" type=\"text/javascript\"></script>\r\n    <script src=\"application/mvc/views/custom_libraries/javascripts/unique_items.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-plugins/datepicker-master/dist/css/bootstrap-datepicker.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"libraries/bootstrap-plugins/datepicker-master/dist/js/bootstrap-datepicker.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/global_functions.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/global.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n\r\n        <script src=\"libraries/bootstrap-plugins/bootstrap-select-master/bootstrap-select-master/dist/js/bootstrap-select.min.js\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-plugins/bootstrap-select-master/bootstrap-select-master/dist/css/bootstrap-select.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <link href=\"application/mvc/views/custom_libraries/css/global.css?rnd=";
echo self::generateRandomStringComplex();
echo "\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/autocomplete.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/jquery.mask.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <script src=\"libraries/bootstrap-plugins/libs/bootstrap-confirmation.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <script src=\"libraries/bootstrap-plugins/bootstrap-sweetalert-master/dist/sweetalert.min.js\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-plugins/bootstrap-sweetalert-master/dist/sweetalert.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"libraries/numeric.js\" type=\"text/javascript\"></script>\r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/store_items.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n        \r\n        <link href=\"application/mvc/views/custom_libraries/svgs/font/style.css?rnd=";
echo self::generateRandomStringComplex();
echo "\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        \r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/stock_invoices.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n        \r\n        <script src=\"libraries/bootstrap-plugins/bootstrap3-typeahead/bootstrap3-typeahead.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <link href=\"libraries/bootstrap-plugins/bootstrap-colorpicker-master/dist/css/bootstrap-colorpicker.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"libraries/bootstrap-plugins/bootstrap-colorpicker-master/dist/js/bootstrap-colorpicker.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <link href=\"libraries/bootstrap-plugins/export/buttons.dataTables.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"libraries/bootstrap-plugins/export/dataTables.buttons.min.js\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/bootstrap-plugins/export/jszip.min.js\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/bootstrap-plugins/export/vfs_fonts.js\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/bootstrap-plugins/export/buttons.html5.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <script src=\"libraries/bootstrap-plugins/Buttons-1.2.4/js/buttons.bootstrap.min.js\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-plugins/Buttons-1.2.4/css/buttons.bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        \r\n        \r\n        <link href=\"libraries/bootstrap-plugins/lightbox-master/dist/ekko-lightbox.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"libraries/bootstrap-plugins/lightbox-master/dist/ekko-lightbox.min.js\" type=\"text/javascript\"></script>\r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/autocomplete.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/excelToJson/xlsx.core.min.js\"></script>  \r\n        <script src=\"libraries/excelToJson/xls.core.min.js\"></script>\r\n        <script src=\"libraries/cleave.js-master/dist/cleave.min.js\" type=\"text/javascript\"></script>\r\n        \r\n        <script src=\"libraries/bootstrap-plugins/daterangepicker-master/moment.min.js\" type=\"text/javascript\"></script>\r\n        <script src=\"libraries/bootstrap-plugins/daterangepicker-master/daterangepicker.js\" type=\"text/javascript\"></script>\r\n        <link href=\"libraries/bootstrap-plugins/daterangepicker-master/daterangepicker.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n        <script src=\"application/mvc/views/custom_libraries/javascripts/jquery-confirm.min.js\"\r\n        type=\"text/javascript\"></script>\r\n    <link href=\"application/mvc/views/custom_libraries/css/jquery-confirm.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n    \r\n        \r\n        <style type=\"text/css\">\r\n            \r\n            .container,.panel {\r\n                height:100%;\r\n                width: 100%;\r\n                padding: 0px !important;\r\n                margin: 0px !important;\r\n            }\r\n            \r\n            \r\n            \r\n            .table>tfoot>tr>th{\r\n                font-size: 12px !important;\r\n                background-color: #F3F3F3;\r\n                padding: 2px;\r\n                border: none !important;\r\n            }\r\n            \r\n            .dataTables_filter { display: none; }\r\n            \r\n            .input-sm{\r\n                height: 25px !important;\r\n            }\r\n            \r\n            .dt-center{\r\n                text-align: center !important;\r\n            }\r\n            \r\n            .selected{\r\n                background-color: #337ab7 !important;\r\n                color: #ffffff !important;\r\n            }\r\n            \r\n            .search_filter{\r\n                width: 100% !important;\r\n                color: #000;\r\n            }\r\n            \r\n            ._readony{\r\n                background-color: #f6f5f5;\r\n                border-style: ridge !important;\r\n            }\r\n            \r\n            \r\n            ::-webkit-input-placeholder { /* Chrome/Opera/Safari */\r\n                color: #337ab7;\r\n                opacity: 0.9;\r\n            }\r\n            ::-moz-placeholder { /* Firefox 19+ */\r\n                color: #337ab7;\r\n                opacity: 0.9;\r\n            }\r\n            :-ms-input-placeholder { /* IE 10+ */\r\n                color: #337ab7;\r\n                opacity: 0.9;\r\n            }\r\n            :-moz-placeholder { /* Firefox 18- */\r\n                color: #337ab7;\r\n                opacity: 0.9;\r\n            }\r\n            \r\n            /* enable absolute positioning */\r\n            .inner-addon { \r\n                position: relative; \r\n            }\r\n\r\n            /* style icon */\r\n            .inner-addon .glyphicon {\r\n              position: absolute;\r\n              padding: 6px;\r\n              pointer-events: none;\r\n            }\r\n\r\n            /* align icon */\r\n            .left-addon .glyphicon  { left:  0px;}\r\n            .right-addon .glyphicon { right: 0px;}\r\n\r\n            \r\n            .phone-input{\r\n                    margin-bottom:8px;\r\n            }\r\n            \r\n            .confirmation {\r\n                width: 160px;\r\n            }\r\n            \r\n            .list-group-item{\r\n                border: none !important;\r\n            }\r\n            \r\n            div.toolbar h3{\r\n                margin-top: 0px !important;\r\n            }\r\n            \r\n            .dataTable>tfoot>tr>th{\r\n                /* width: 50px !important; */\r\n            }\r\n            \r\n            .item_icon{\r\n                font-size: 18px;\r\n            }\r\n            .addon_item_icon input{\r\n                padding-left: 30px !important;\r\n            }\r\n            \r\n            #receive_stockModal .modal-dialog{\r\n                width: 99% !important;\r\n               max-height: 550px;\r\n            }\r\n            \r\n            #receive_stockModal .modal-footer{\r\n                padding-top: 5px !important;\r\n                padding-bottom: 5px !important;\r\n            }\r\n            \r\n            #receive_stockModal .modal-header{\r\n               padding-top: 5px !important;\r\n               padding-bottom: 5px !important;\r\n            }\r\n            \r\n            #receive_stockModal input{\r\n               padding-top: 0px !important;\r\n               padding-bottom: 0px !important;\r\n            }\r\n            #receive_stockModal .form-control{\r\n               height: 28px !important;\r\n               padding-left: 2px !important;\r\n               padding-right: 2px !important;\r\n               border-radius: 0px !important;\r\n            }\r\n            \r\n            \r\n            \r\n            #receive_stockModal .bootstrap-select>.dropdown-toggle{\r\n                padding-left: 2px !important;\r\n                padding-right: 4px !important;\r\n            }\r\n            \r\n            #receive_stockModal .bootstrap-select.btn-group .dropdown-toggle .caret{\r\n                right: 2px !important;\r\n            }\r\n            \r\n            #receive_stockModal .btn{\r\n               border-radius: 0px !important;\r\n            }\r\n            \r\n            .currency_label{\r\n                font-size: 12px !important;\r\n            }\r\n            \r\n            #receive_stockModal button{\r\n               padding-bottom: 2px !important;\r\n            }\r\n            \r\n            \r\n            #po_modal .modal-body{\r\n                padding-top: 5px !important;\r\n                padding-bottom: 5px !important;\r\n            }\r\n            \r\n\r\n            #receive_stockModal button{\r\n                \r\n            }\r\n            \r\n            #stock_invoices button{\r\n                width: 100% !important;\r\n            }\r\n            \r\n            .stock_entry_header{\r\n                overflow-y: scroll;\r\n                margin-top: 5px;\r\n            }\r\n            \r\n            .stock_entry_header div{\r\n                padding-left: 0px !important; \r\n                padding-right: 0px !important;\r\n                border: none !important;\r\n                background-color: #337ab7;\r\n                color: #ffffff;\r\n                border-right: 1px solid #fff;\r\n                font-size: 17px;\r\n            }\r\n            \r\n            .stock_entry div{\r\n                padding-left: 1px !important; \r\n                padding-right: 1px !important;\r\n                font-size: 16px;\r\n            }\r\n            \r\n            .stock_entry:hover{\r\n                background-color: #ccc;\r\n            }\r\n            \r\n            .stock_entry input{\r\n                height: 23px;\r\n                font-size: 15px;\r\n                width: 100%;\r\n                text-align: left;\r\n                margin-top: 1px !important;\r\n                margin-bottom: 1px !important;\r\n            }\r\n            \r\n            select{\r\n                height: 23px;\r\n                font-size: 14px;\r\n                width: 100%;\r\n                margin-top: 1px !important;\r\n                margin-bottom: 1px !important;\r\n            }\r\n            \r\n            /* add padding  */\r\n            \r\n            \r\n            .modal-body .row{\r\n            \r\n            }\r\n            \r\n            .plr2{\r\n                padding-left: 1px !important;\r\n                padding-right: 1px !important;\r\n            }\r\n            \r\n            .modal-body{\r\n                padding: 18px !important;\r\n                padding-top: 5px !important;\r\n            }\r\n            \r\n            #items_body{\r\n                max-height: 330px !important;\r\n                overflow-y: scroll;\r\n            }\r\n            \r\n            #exTab1 .tab-content {\r\n                background-color: transparent;\r\n                padding : 15px 15px;\r\n                border-bottom: 1px solid #CCC;\r\n                border-left: 1px solid #CCC;\r\n                border-right: 1px solid #CCC;\r\n                border-top: 1px solid #CCC;\r\n            }\r\n\r\n            #exTab1 .nav-pills > li > a {\r\n                border-radius: 4px 4px 0 0;\r\n                border: 1px solid #CCC;\r\n                border-bottom: 0px solid #CCC;\r\n                padding-top: 5px;\r\n                padding-bottom: 5px;\r\n            }\r\n            \r\n            /* add padding  */\r\n            .left-addon input  { padding-left:  5px; }\r\n            .right-addon input { padding-right: 5px; }\r\n            \r\n            .trash_icon{\r\n                font-size: 18px;\r\n                cursor: pointer;\r\n            }\r\n            \r\n            .form-group{\r\n                margin-bottom: 3px !important;\r\n            }\r\n            \r\n            .btn {\r\n                font-size: 13px !important;\r\n            }\r\n            \r\n            ul.typeahead.dropdown-menu {\r\n                max-height: 300px;\r\n                overflow: auto;\r\n            }\r\n            \r\n            label{\r\n                margin-bottom: 0px !important;\r\n                font-size: 15px !important;\r\n            }\r\n            \r\n            .bootstrap-select:not([class*=col-]):not([class*=form-control]):not(.input-group-btn){\r\n                width: 100% !important;\r\n            }\r\n            \r\n            .pi_info_box{\r\n                background-color: #8a8a8a;\r\n                padding-top: 5px;\r\n                color: #fff;\r\n                height: 35px;\r\n                font-size: 16px;\r\n                border-style: ridge !important;\r\n                padding-left: 5px !important;\r\n            }\r\n            \r\n            .tot_bcg{\r\n                background-color: antiquewhite;\r\n                border-style: ridge !important;\r\n            }\r\n            \r\n            /* align icon */\r\n            .left-addon .glyphicon  { left:  0px;}\r\n            .right-addon .glyphicon { right: 0px;}\r\n\r\n            .tooltip-inner{\r\n                padding: 0px !important;\r\n            }\r\n            \r\n            .selected .glyphicon-trash{\r\n                color: #fff !important;\r\n            }\r\n            \r\n            .panel > .panel-heading{\r\n                 padding: 1px 6px  !important;\r\n            }\r\n            \r\n        </style>\r\n\r\n        <script type=\"text/javascript\">\r\n            var all_items = [];\r\n             var hide_critical_data=";
echo $_SESSION["hide_critical_data"];
echo ";\r\n            \r\n            var main_currency = '";
echo $_SESSION["currency_symbol"];
echo "';\r\n            var only_1_currency=0;\r\n            if(main_currency!=\"USD\" && main_currency!=\"LBP\"){\r\n                only_1_currency=1;\r\n            }\r\n            \r\n            var hide_cost=";
echo $_SESSION["hide_critical_data"];
echo ";\r\n            \r\n            \r\n            var mobile_shop = 0;\r\n            ";
if ($data["mobile_shop"] == 1) {
    echo "                mobile_shop = 1;\r\n            ";
}
echo "            \r\n            var current_pi_id = 0;\r\n            \r\n            var omt_version = ";
echo OMT_VERSION;
echo ";\r\n            \r\n            var Total_more = 0;\r\n            var Total_more_not_applied_on_items_cost = 0;\r\n            \r\n            var all_items_index = 0;\r\n            var all_items_index_array = [all_items_index];\r\n\r\n            var all_warehouses = [];\r\n            var all_stores = [];\r\n            var all_suppliers = [];\r\n            var all_currencies = [];\r\n            var payment_status = [];\r\n            var payment_methods = [];\r\n            \r\n            var currency_system_name = \"\";\r\n            \r\n            var default_currency_symbol = null;\r\n            var vatValue = null;\r\n            var apply_vat_sales_item = null;\r\n            var receive_stock_data = [];\r\n            \r\n            \r\n            var suppliers = [];\r\n            var current_supplier_id = null;\r\n            \r\n            var  ptype_hide = \";display:block;\";\r\n            ";
if ($_SESSION["ptype"] == 1) {
    echo "                ptype_hide = \";display:none;\";\r\n            ";
}
echo "            \r\n            var enable_wholasale = ";
echo $data["enable_wholasale"];
echo ";\r\n            \r\n            function calculate_pi_more_per_item(){\r\n                var total_items_qty = 0;\r\n                var average = 0;\r\n\r\n                \$(\".qqty\").each(function( i ) {\r\n                    total_items_qty+= parseFloat(\$(this).val());\r\n                });\r\n                \r\n                if(total_items_qty>0)\r\n                    average = Total_more/total_items_qty;\r\n                \r\n                //alert(total_items_qty);\r\n                \$(\".more_val\").val(parseFloat(average).toFixed(get_decimal_to_fix(\$(\"#currency_id\").val())));\r\n            }\r\n            \r\n            function calculate_invoice_more_not_applied(){\r\n                Total_more_not_applied_on_items_cost = 0;\r\n                \$.getJSON(\"?r=stock&f=get_pi_more_data&p0=\"+current_pi_id, function (data) {\r\n                    \$.each(data, function (key, val) {\r\n                        if(val.type_id==1 && val.apply_to_pi==0){\r\n                            Total_more_not_applied_on_items_cost-=parseFloat(val.value);\r\n                        }\r\n                        if(val.type_id==2 && val.apply_to_pi==0){\r\n                            Total_more_not_applied_on_items_cost+=parseFloat(val.value);\r\n                        }\r\n                    });\r\n                }).done(function () {\r\n                    //alert(Total_more_not_applied_on_items_cost);\r\n                    total_invoice_values();\r\n                });\r\n            }\r\n            \r\n            function show_pi_logs(id){\r\n                var content =\r\n                '<div class=\"modal large\" data-backdrop=\"static\" id=\"pi_logs_modal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"payment_info__\" aria-hidden=\"true\">\\n\\\r\n                    <div class=\"modal-dialog\" role=\"document\">\\n\\\r\n                        <form id=\"transfer_form\" action=\"\" method=\"post\" enctype=\"multipart/form-data\" >\\n\\\r\n                            <div class=\"modal-content\">\\n\\\r\n                                <div class=\"modal-header\">\\n\\\r\n                                    <h3 class=\"modal-title\">Logs<i style=\"float:right;font-size:30px; cursor:pointer\" class=\"glyphicon glyphicon-remove\" onclick=\"close_pilog_modal()\"></i></h3>\\n\\\r\n                                </div>\\n\\\r\n                                <div class=\"modal-body\">\\n\\\r\n                                    <div class=\"row\">\\n\\\r\n                                        <div class=\"col-lg-12 col-md-12 col-xs-12\">\\n\\\r\n                                            <table id=\"log_pi_table\" class=\"table table-striped table-bordered\" cellspacing=\"0\">\\n\\\r\n                                                <thead>\\n\\\r\n                                                    <tr>\\n\\\r\n                                                        <th style=\"width:90px;\">Creation Date</th>\\n\\\r\n                                                        <th style=\"width:70px;\">Changed By</th>\\n\\\r\n                                                        <th>Item</th>\\n\\\r\n                                                        <th>Description</th>\\n\\\r\n                                                    </tr>\\n\\\r\n                                                </thead>\\n\\\r\n                                                <tfoot>\\n\\\r\n                                                    <tr>\\n\\\r\n                                                        <th>Creation Date</th>\\n\\\r\n                                                        <th>Changed By</th>\\n\\\r\n                                                        <th>Item</th>\\n\\\r\n                                                        <th>Descriptionth>\\n\\\r\n                                                    </tr>\\n\\\r\n                                                </tfoot>\\n\\\r\n                                                <tbody></tbody>\\n\\\r\n                                            </table>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                </div>\\n\\\r\n                            </div>\\n\\\r\n                        </form>\\n\\\r\n                    </div>\\n\\\r\n                </div>';\r\n                \$(\"#pi_logs_modal\").modal(\"hide\");\r\n                \$(\"body\").append(content);\r\n\r\n                \$(\"#pi_logs_modal\").centerWH();\r\n\r\n                \$('#pi_logs_modal').on('show.bs.modal', function (e) {\r\n                });\r\n\r\n                \$('#pi_logs_modal').on('shown.bs.modal', function (e) {\r\n                    var search_fields = [0,1,2,3];\r\n                    var index = 0;\r\n                    \$('#log_pi_table tfoot th').each( function () {\r\n                        if(jQuery.inArray(index, search_fields) !== -1){\r\n                            var title = \$(this).text();\r\n                            \$(this).html( '<div class=\"inner-addon left-addon\"><input id=\"idf_'+index+'\" style=\"width: 100% !important;\"  class=\"form-control input-sm\" type=\"text\" placeholder=\"'+title+'\" /></div>' );\r\n                            index++;\r\n                        }\r\n                    });\r\n\r\n                    \$('#log_pi_table').dataTable({\r\n                        ajax: \"?r=stock&f=get_log_pi&p0=\"+id,\r\n                        responsive: true,\r\n                        orderCellsTop: true,\r\n                        bLengthChange: true,\r\n                        iDisplayLength: 100,\r\n                        aoColumnDefs: [\r\n                            { \"targets\": [0], \"searchable\": true, \"orderable\": true, \"visible\": true },\r\n                            { \"targets\": [1], \"searchable\": true, \"orderable\": true, \"visible\": true },\r\n                            { \"targets\": [2], \"searchable\": true, \"orderable\": true, \"visible\": true },\r\n                            { \"targets\": [3], \"searchable\": true, \"orderable\": true, \"visible\": true },\r\n                        ],\r\n                        scrollY: '45vh',\r\n                        scrollCollapse: true,\r\n                        paging: true,\r\n                        order: [[ 0, \"asc\" ]],\r\n                        dom: '<\"toolbar_log_pi\">frtip',\r\n                        initComplete: function( settings ) {\r\n                        },\r\n                        fnRowCallback: function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {\r\n                            \$(nRow).addClass(aData[0]);\r\n                        },\r\n                        fnDrawCallback: function(){\r\n                            \r\n                        },\r\n                    });\r\n\r\n                    \$('#log_pi_table tbody').on( 'mouseenter', 'tr', function () {\r\n                        \$(\".selected\").removeClass(\"selected\");\r\n                        \$(this).addClass(\"selected\");\r\n                    } );\r\n\r\n\r\n                    \$('#log_pi_table').DataTable().columns().every( function () {\r\n                        var that = this;\r\n                        \$('input', this.footer()).on( 'keyup change', function () {\r\n                            if ( that.search() !== this.value ) {\r\n                                that.search( this.value ).draw();\r\n                            }\r\n                        } );\r\n                    } );\r\n                });\r\n\r\n                \$('#pi_logs_modal').on('hide.bs.modal', function (e) {\r\n                    \$('#pi_logs_modal').remove();\r\n                });\r\n\r\n\r\n                \$('#pi_logs_modal').modal('show');  \r\n            }\r\n            \r\n            function close_pilog_modal(){\r\n                \$('#pi_logs_modal').modal('hide');  \r\n            }\r\n            \r\n            function init(){\r\n                \$(\".sk-circle\").center();\r\n                \$(\".sk-circle-layer\").show();\r\n                \$.getJSON(\"?r=settings_info&f=get_needed_data\", function (data) {\r\n                    default_currency_symbol = data.default_currency_symbol;\r\n                    vatValue = data.vat;\r\n                    apply_vat_sales_item = data.apply_vat_sales_item;\r\n                    \r\n                    all_suppliers = [];\r\n                    \$.each(data.suppliers, function (key, val) {\r\n                        if(current_supplier_id==null){\r\n                            current_supplier_id = 0;\r\n                        }\r\n                        all_suppliers.push({id:val.id,name:val.name});\r\n                    });\r\n                    \r\n                    payment_status = [];\r\n                    \$.each(data.payment_status, function (key, val) {\r\n                        payment_status.push({id:val.id,name:val.status_name});\r\n                    });\r\n                    \r\n                    all_warehouses = [];\r\n                    \$.each(data.warehouses, function (key, val) {\r\n                        all_warehouses.push({'id':val.id,'location':val.location});\r\n                    });\r\n                    \r\n                    all_items = [];\r\n                    \$.each(data.all_items, function (key, val) {\r\n                        all_items.push({'id':val.id,'description':val.description,'barcode':val.barcode,'unit_cost':val.buying_cost,'vat':val.vat});\r\n                    });\r\n                    \r\n                    all_stores = [];\r\n                    \$.each(data.stores, function (key, val) {\r\n                        all_stores.push({id:val.id,name:val.name});\r\n                    });\r\n                    \r\n                    all_currencies = [];\r\n                    \$.each(data.currencies, function (key, val) {\r\n                        if(val.system_default==1){\r\n                            currency_system_name = val.symbole;\r\n                        }\r\n                        all_currencies.push({id:val.id,name:val.name,symbole:val.symbole,system_default:val.system_default,rate_to_system_default:val.rate_to_system_default,pi_decimal:val.pi_decimal});\r\n                    });  \r\n                }).done(function () {\r\n                     getStockInvoices();\r\n                });\r\n            }\r\n            \r\n            function get_decimal_format(currency_id){\r\n                for(var i=0;i<all_currencies.length;i++){\r\n                    if(currency_id == all_currencies[i].id){\r\n                        if(all_currencies[i].pi_decimal==0){\r\n                            return \"#,##0\";\r\n                        }else if(all_currencies[i].pi_decimal==1){\r\n                            return \"#,##0.0\";\r\n                        }else if(all_currencies[i].pi_decimal==2){\r\n                            return \"#,##0.00\";\r\n                        }else if(all_currencies[i].pi_decimal==3){\r\n                            return \"#,##0.000\";\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            function get_decimal_format_nb(currency_id){\r\n                for(var i=0;i<all_currencies.length;i++){\r\n                    if(currency_id == all_currencies[i].id){\r\n                        if(all_currencies[i].pi_decimal==0){\r\n                            return 0;\r\n                        }else if(all_currencies[i].pi_decimal==1){\r\n                            return 1;\r\n                        }else if(all_currencies[i].pi_decimal==2){\r\n                            return 2;\r\n                        }else if(all_currencies[i].pi_decimal==3){\r\n                            return 3;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            function get_decimal_to_fix(currency_id){\r\n                for(var i=0;i<all_currencies.length;i++){\r\n                    if(currency_id == all_currencies[i].id){\r\n                        return all_currencies[i].pi_decimal;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            \r\n            \$(document).ready(function () {\r\n                init();\r\n                /*\r\n                \$(\".sk-circle\").center();\r\n                \$(\".sk-circle-layer\").show();\r\n                \$.getJSON(\"?r=settings_info&f=getSettingsInfo\", function (data) {\r\n                    default_currency_symbol = data.default_currency_symbol;\r\n                    vatValue = data.vat;\r\n                }).done(function () {\r\n                    \$.getJSON(\"?r=suppliers&f=get_suppliers\", function (data) {\r\n                        \$.each(data, function (key, val) {\r\n                            if(current_supplier_id==null){\r\n                                current_supplier_id = 0;\r\n                            }\r\n                            suppliers.push({id:val.id,name:val.name});\r\n                        });\r\n                    }).done(function () {\r\n                        init();\r\n                    });\r\n                }); \r\n                */\r\n            });\r\n            \r\n            //function init(){\r\n                //get_payment_status();\r\n            //}\r\n            \r\n            function getAllReceiveStockData(){\r\n                receive_stock_data = [];\r\n                for(var i=0;i<all_items_index_array.length;i++){\r\n                    if(\$(\"#row_\"+all_items_index_array[i]).length>0){\r\n                        \r\n                        var _qty = \$(\"#qty_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        if(_qty==\"\" || _qty==null)\r\n                            _qty = 0;\r\n                        \r\n                        var _fqty = \$(\"#fqty_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        if(_fqty==\"\" || _fqty==null)\r\n                            _fqty = 0;\r\n                        \r\n                        var _expdt= \$(\"#expiry_hidden_\"+all_items_index_array[i]).val();\r\n                        if(_expdt==\"\" || _expdt==null)\r\n                            _expdt = 0;\r\n\r\n                        var _unit_cost = \$(\"#uc_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        if(_unit_cost==\"\" || _unit_cost==null)\r\n                            _unit_cost = 0;\r\n                        else\r\n                            _unit_cost = \$(\"#uc_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        \r\n                        var _unit_discount = \$(\"#disc_\"+all_items_index_array[i]).val();\r\n                        if(_unit_discount==\"\" || _unit_discount==null)\r\n                            _unit_discount = 0;\r\n                        else\r\n                            _unit_discount = \$(\"#disc_\"+all_items_index_array[i]).val();\r\n                        \r\n                        var _unit_discount_2 = \$(\"#disc2_\"+all_items_index_array[i]).val();\r\n                        if(_unit_discount_2==\"\" || _unit_discount_2==null)\r\n                            _unit_discount_2 = 0;\r\n                        else\r\n                            _unit_discount_2 = \$(\"#disc2_\"+all_items_index_array[i]).val();\r\n                        \r\n                        \r\n                        var _unit_discount_after_vat = \$(\"#discAfterVat_\"+all_items_index_array[i]).val();\r\n                        if(_unit_discount_after_vat==\"\" || _unit_discount_after_vat==null)\r\n                            _unit_discount_after_vat = 0;\r\n                        else\r\n                            _unit_discount_after_vat = \$(\"#discAfterVat_\"+all_items_index_array[i]).val();\r\n                        \r\n\r\n                        var _vat = 0;\r\n                        if(\$(\"#vat_\"+all_items_index_array[i]).is(':checked')){\r\n                            _vat=1;\r\n                        }\r\n                        var _supplier_item_ref = \$(\"#supref_\"+all_items_index_array[i]).val();\r\n                        \r\n                        var _print_barcode = \$(\"#print_bar_\"+all_items_index_array[i]).val();\r\n                        \r\n                        var _charge = \$(\"#charge_\"+all_items_index_array[i]).val();\r\n                     \r\n                        \r\n                        var _final_unit_cost = \$(\"#unit_cost_after_discount_and_vat_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                         \r\n                        receive_stock_data.push({item_id:\$(\"#item_id_\"+all_items_index_array[i]).val(),store_id:\$(\"#store_id_\"+all_items_index_array[i]).val(),qty:_qty,fqty:_fqty,unit_cost:_unit_cost,index:all_items_index_array[i],vat:_vat,supplier_item_ref:_supplier_item_ref,unit_discount:_unit_discount,unit_discount_2:_unit_discount_2,new_item:0,print_barcode:_print_barcode,final_unit_cost:_final_unit_cost,discount_after_vat:_unit_discount_after_vat,expiry_date:_expdt,charge:_charge});\r\n\r\n                    }\r\n                    \r\n                    if(\$(\"#nrow_\"+all_items_index_array[i]).length>0){\r\n                        var _qty = \$(\"#qty_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        if(_qty==\"\" || _qty==null)\r\n                            _qty = 0;\r\n\r\n                        var _fqty = \$(\"#fqty_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        if(_fqty==\"\" || _fqty==null)\r\n                            _fqty = 0;\r\n                        \r\n                        \r\n                        \r\n                        var _expdt = \$(\"#expiry_hidden_\"+all_items_index_array[i]).val();\r\n                        if(_expdt==\"\" || _expdt==null)\r\n                            _expdt = 0;\r\n                        \r\n                        \r\n                        \r\n                        var _unit_cost = \$(\"#uc_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        if(_unit_cost==\"\" || _unit_cost==null)\r\n                            _unit_cost = 0;\r\n                        else\r\n                            _unit_cost = \$(\"#uc_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        \r\n                        var _unit_discount = \$(\"#disc_\"+all_items_index_array[i]).val();\r\n                        if(_unit_discount==\"\" || _unit_discount==null)\r\n                            _unit_discount = 0;\r\n                        else\r\n                            _unit_discount = \$(\"#disc_\"+all_items_index_array[i]).val();\r\n                        \r\n                        var _unit_discount_2 = \$(\"#disc2_\"+all_items_index_array[i]).val();\r\n                        if(_unit_discount_2==\"\" || _unit_discount_2==null)\r\n                            _unit_discount_2 = 0;\r\n                        else\r\n                            _unit_discount_2 = \$(\"#disc2_\"+all_items_index_array[i]).val();\r\n                        \r\n                        \r\n                        var _unit_discount_after_vat = \$(\"#discAfterVat_\"+all_items_index_array[i]).val();\r\n                        if(_unit_discount_after_vat==\"\" || _unit_discount_after_vat==null)\r\n                            _unit_discount_after_vat = 0;\r\n                        else\r\n                            _unit_discount_after_vat = \$(\"#discAfterVat_\"+all_items_index_array[i]).val();\r\n                        \r\n                       \r\n                        var _vat = 0;\r\n                        if(\$(\"#vat_\"+all_items_index_array[i]).is(':checked')){\r\n                            _vat=1;\r\n                        }\r\n                        var _supplier_item_ref = \$(\"#supref_\"+all_items_index_array[i]).val();\r\n                        \r\n                        var _print_barcode = \$(\"#print_bar_\"+all_items_index_array[i]).val();\r\n                        \r\n                        var _final_unit_cost = \$(\"#unit_cost_after_discount_and_vat_\"+all_items_index_array[i]).val().replace(/,/g , '');\r\n                        var _charge = \$(\"#charge_\"+all_items_index_array[i]).val();\r\n\r\n                        receive_stock_data.push({item_id:\$(\"#item_id_\"+all_items_index_array[i]).val(),store_id:\$(\"#store_id_\"+all_items_index_array[i]).val(),qty:_qty,fqty:_fqty,unit_cost:_unit_cost,index:all_items_index_array[i],vat:_vat,supplier_item_ref:_supplier_item_ref,unit_discount:_unit_discount,unit_discount_2:_unit_discount_2,new_item:1,print_barcode:_print_barcode,final_unit_cost:_final_unit_cost,discount_after_vat:_unit_discount_after_vat,expiry_date:_expdt,charge:_charge});\r\n\r\n                    }\r\n                }\r\n                return receive_stock_data;\r\n            }\r\n            \r\n            function getAllReceiveStock(close_modal){\r\n                if(\$(\"#supplier_id\").val()==0){\r\n                    swal(\"Supplier not selected\");\r\n                    return;\r\n                }\r\n                \r\n                //if(\$(\"#invoice_reference\").val()==\"\"){\r\n                    //swal(\"PI number is empty\");\r\n                    //return;\r\n                //}\r\n                 \r\n                var tmp_action_type = \$(\"#action_type\").val();\r\n                if(\$(\"#receive_stock_btn\").hasClass(\"disabled\")==false && \$(\"#items_body div.row\").length>0){\r\n                    \$(\".sk-circle-layer\").show();\r\n                    if(close_modal==1){\r\n                        \$(\"#receive_stock_btn\").addClass(\"disabled\");\r\n                    }\r\n            \r\n                    receive_stock_data = getAllReceiveStockData();\r\n\r\n                    \$.ajax({\r\n                        type: 'POST',\r\n                        url: '?r=stock&f=receive_stock_data',\r\n                        dataType: 'json',\r\n                        data: {'items': receive_stock_data,'supplier_id':\$(\"#supplier_id\").val(),'invoice_date':\$(\"#invoice_date\").val(),'delivery_date':\$(\"#delivery_date\").val(),'invoice_subtotal':\$(\"#invoice_subtotal\").val().replace(/,/g , ''),'invoice_discount':\$(\"#invoice_discount\").val().replace(/,/g , ''),'invoice_total':\$(\"#invoice_total\").val().replace(/,/g , ''),'invoice_tax':\$(\"#invoice_tax\").val().replace(/,/g , ''),'action_type':\$(\"#action_type\").val(),'payment_status':\$(\"#payment_status\").val(),'invoice_reference':\$(\"#invoice_reference\").val(),'autofill_id':\$(\"#autofill_id\").val(),'charge_type_id':\$(\"#charge_type_id\").val(),'currency_id':\$(\"#currency_id\").val(),'cur_rate':\$(\"#cur_rate\").val().replace(/,/g , '')},\r\n                        success: function(msg) {\r\n                            if(close_modal==1){\r\n                                var p_ttl = \$(\"#invoice_total\").val();\r\n                                var p_cur_id = \$(\"#currency_id\").val();\r\n                                \r\n                                \$('.tooltip_exp').tooltip('destroy');\r\n                           \r\n                                \$('#receive_stockModal').modal('toggle');\r\n                                var table = \$('#stock_invoices').DataTable();\r\n                            \r\n                                table.ajax.url(\"?r=stock&f=getStockInvoices&p0=\"+\$(\"#suppliers_list\").val()+\"&p1=\"+\$(\"#payment_status_list\").val()+\"&p2=\"+\$(\"#piDate\").val()).load(function () {\r\n                                    if(tmp_action_type==0){\r\n                                        table.page('first').draw(false);\r\n                                        table.row(':first', {page: 'current'}).select();\r\n                                    }else{\r\n                                        table.row('.' + PadSTKINV(msg), {page: 'current'}).select();\r\n                                    }\r\n                                    update_pi_info();\r\n                                    \r\n                                    \$(\".sk-circle-layer\").hide();\r\n                                    \r\n                                    if(NEW_PI_GEN==1){\r\n                                        /*add_supplier_payment('stock_invoice');\r\n                                        setTimeout(function(){\r\n                                            \$(\"#payment_value\").val(p_ttl);\r\n                                            \$(\"#payment_currency\").selectpicker('val',p_cur_id);\r\n                                        },1000);*/\r\n                                    }\r\n                                    \r\n                                },false);\r\n                                \r\n                                \r\n                            }else{\r\n                                \$('.tooltip_exp').tooltip('destroy');\r\n                            }\r\n                        },\r\n                    }).fail(function() {\r\n                        \$(\".sk-circle-layer\").hide();\r\n                        \$(\"#receive_stock_btn\").removeClass(\"disabled\");\r\n                        swal(\"Saving Error, please check your connection\");\r\n                    }).always(function() {\r\n                    });\r\n                }else{\r\n                    if(\$(\"#items_body div.row\").length==0){\r\n                        swal(\"Empty Invoice\");\r\n                    }\r\n                }\r\n            }\r\n            \r\n            function updateSuppliers(){\r\n                all_suppliers = [];\r\n                \$.getJSON(\"?r=suppliers&f=get_suppliers\", function (data) {\r\n                    \$.each(data, function (key, val) {\r\n                        all_suppliers.push({id:val.id,name:val.name});\r\n                    });\r\n                }).done(function () {\r\n                    \r\n                });\r\n            }\r\n        \r\n            function updateAllItems(item_id){\r\n                \$(\".sk-circle\").center();\r\n                \$(\".sk-circle-layer\").show();\r\n                all_items = [];\r\n                \$.getJSON(\"?r=items&f=getAllItems_\", function (data) {\r\n                    \$.each(data, function (key, val) {\r\n                        all_items.push({'id':val.id,'description':val.description,'barcode':val.barcode,'unit_cost':val.buying_cost,'vat':val.vat});\r\n                    });\r\n                }).done(function () {\r\n                    \r\n                    \$.get(\"?r=items&f=get_items_names_without_boxes\", function(data){\r\n                        var search_by_name_typehead = \$('#search_by_name').typeahead();\r\n                        search_by_name_typehead.data('typeahead').source = data;\r\n                        \r\n                    },'json')\r\n                    .done(function(){\r\n                        \$('#newItem').modal('hide');\r\n                        \$(\".sk-circle-layer\").hide();\r\n                        if(item_id>0){\r\n                            var ind = addItemToInvoice(item_id,[]);\r\n                            //updateOtherInfo(ind);\r\n                        }\r\n                    })\r\n                    .fail(function() {\r\n                    })\r\n                    .always(function() {\r\n                    });\r\n                    \r\n                });  \r\n            }\r\n            \r\n            \r\n            function getAllItems(){\r\n                \$(\".sk-circle\").center();\r\n                \$(\".sk-circle-layer\").show();\r\n                all_items = [];\r\n                \$.getJSON(\"?r=items&f=getAllItems_\", function (data) {\r\n                    \$.each(data, function (key, val) {\r\n                        all_items.push({'id':val.id,'description':val.description,'barcode':val.barcode,'unit_cost':val.buying_cost,vat:val.vat});\r\n                    });\r\n                }).done(function () {\r\n                    \r\n                    getStockInvoices();\r\n                });  \r\n            }\r\n            \r\n            function closeReceiveStock(moved_stock){\r\n                //alert(moved_stock);\r\n                if(moved_stock==0){\r\n                    if(\$(\"#items_body div.row\").length>0){\r\n                        swal({\r\n                        title: \"Are you sure?\",\r\n                        text: \"All changes will be discarded\",\r\n                        type: \"warning\",\r\n                        showCancelButton: true,\r\n                        confirmButtonClass: \"btn-danger\",\r\n                        confirmButtonText: \"Yes\",\r\n                        closeOnConfirm: true,\r\n                        cancelButtonText: \"Cancel\",\r\n                    },\r\n                    function(isConfirm){\r\n                        if(isConfirm){\r\n                            \$('#receive_stockModal').modal('toggle');\r\n                        }\r\n                    });\r\n                    }else{\r\n                        \$('#receive_stockModal').modal('toggle');\r\n                    }\r\n                }else{\r\n                    \$('#receive_stockModal').modal('toggle');\r\n                }\r\n            }\r\n            \r\n            function getOptionOfItemsId(item_id){\r\n                var options=\"\";\r\n                for(var i=0;i<all_items.length;i++){\r\n                    if(item_id==all_items[i].id){\r\n                        options+=\"<option value='\"+all_items[i].id+\"' title='\"+all_items[i].id+\"'>\"+all_items[i].id+\"</option>\";\r\n                    } \r\n                }\r\n                return options;\r\n            }\r\n            \r\n            function getOptionsOfPaymentStatus(){\r\n                var options = \"\";\r\n                for(var i=0;i<payment_status.length;i++){\r\n                    options+=\"<option value='\"+payment_status[i].id+\"' title='\"+payment_status[i].name+\"'>\"+payment_status[i].name+\"</option>\";\r\n                }\r\n                return options;\r\n            }\r\n            \r\n            function getOptionsSuppliers(){\r\n                var options = \"<option value='0'>Select Supplier</option>\";\r\n                for(var i=0;i<all_suppliers.length;i++){\r\n                    options+=\"<option value='\"+all_suppliers[i].id+\"' title='\"+all_suppliers[i].name+\"'>\"+all_suppliers[i].name+\"</option>\";\r\n                }\r\n                return options;\r\n            }\r\n            \r\n            function getOptionsCurrencies(){\r\n                var options = \"\";\r\n                var selected= \"\";\r\n                for(var i=0;i<all_currencies.length;i++){\r\n                    selected= \"\";\r\n                    if(all_currencies[i].system_default==1){\r\n                        selected= \"selected\";\r\n                    }\r\n                    options+=\"<option \"+selected+\" value='\"+all_currencies[i].id+\"' title='\"+all_currencies[i].name+\" (\"+all_currencies[i].symbole+\")'>\"+all_currencies[i].name+\" (\"+all_currencies[i].symbole+\")</option>\";\r\n                }\r\n                return options;\r\n            }\r\n            \r\n            function getOptionsOfStores(){\r\n                var options = \"\";\r\n                for(var i=0;i<all_stores.length;i++){\r\n                    options+=\"<option value='\"+all_stores[i].id+\"' title='\"+all_stores[i].name+\"'>\"+all_stores[i].name+\"</option>\";\r\n                }\r\n                return options;\r\n            }\r\n            \r\n            function getOptionsOfWarehouses(){\r\n                var options = \"\";\r\n                for(var i=0;i<all_warehouses.length;i++){\r\n                    options+=\"<option value='\"+all_warehouses[i].id+\"' title='\"+all_warehouses[i].location+\"'>\"+all_warehouses[i].location+\"</option>\";\r\n                }\r\n                return options;\r\n            }\r\n            \r\n            function updateOtherInfo(index_row,item_id){\r\n    \r\n                \$.getJSON(\"?r=items&f=get_item_by_id__&p0=\"+item_id, function (data) {\r\n                    \$(\"#description_\"+index_row).val(data[0].description);\r\n                    if(data[0].vat==1){\r\n                        \$(\"#vat_\"+index_row).attr('checked', true);\r\n                    }\r\n                }).done(function () {\r\n                    \r\n                });\r\n            }\r\n            \r\n            function deleteItem(index){\r\n                \r\n                \$.confirm({\r\n                        title: 'Remove item from PI?',\r\n                        content: '',\r\n                        animation: 'zoom',\r\n                        closeAnimation: 'zoom',\r\n                        animateFromElement:false,\r\n                        buttons: {\r\n                            REMOVE: {\r\n                                btnClass: 'btn-danger',\r\n                                action: function(){\r\n                                    if(\$(\"#items_body div.row\").length>0){\r\n                                        if(\$(\"#action_type\").val()==0){\r\n                                            \$('#ic_exp_'+index).tooltip(\"destroy\");\r\n                                            \$(\"#row_\"+index).remove();\r\n\r\n\r\n                                            total_invoice_values();\r\n                                        }else{\r\n                                            if(\$(\"#nrow_\"+index).length>0){\r\n                                                \$('#ic_exp_'+index).tooltip('destroy');\r\n                                                \$(\"#nrow_\"+index).remove();\r\n\r\n\r\n                                                total_invoice_values();\r\n                                            }else{\r\n                                                \$.getJSON(\"?r=stock&f=delete_item_from_invoice_order&p0=\"+index, function (data) {\r\n\r\n                                                }).done(function () {\r\n                                                    \$('#ic_exp_'+index).tooltip('destroy');\r\n                                                    \$(\"#row_\"+index).remove();\r\n\r\n                                                    total_invoice_values();\r\n                                                });\r\n                                            }\r\n\r\n\r\n                                        }\r\n                                    }\r\n                                }\r\n                            },\r\n                            CANCEL: {\r\n                                btnClass: 'btn-default any-other-class', // multiple classes.\r\n                                action: function(){\r\n\r\n                                }\r\n                            },\r\n                        }\r\n                    });\r\n            }\r\n            \r\n            function define_new_items(ac){\r\n                if(!\$(\"#receive_stockModal button\").hasClass(\"disabled\")){\r\n                    addItem(ac);\r\n                }\r\n            }\r\n            \r\n            \r\n            \r\n            function total_invoice_values(){\r\n                \r\n                if(\$(\"#autofill_id\").val()==\"1\"){\r\n                    var total = 0;\r\n                    var discount_value = 0;\r\n                    var discount_value_2 = 0;\r\n                    var tmp = 0;\r\n                    var vat_value = 0;\r\n                    \r\n                    var total_discount_after_vat = 0;\r\n                    \r\n                    var dataItems = getAllReceiveStockData();\r\n                    for(var i=0;i<dataItems.length;i++){\r\n                        total+=(dataItems[i].qty*dataItems[i].unit_cost);\r\n                        //alert(dataItems[i].qty*dataItems[i].unit_cost*(dataItems[i].unit_discount/100));\r\n                        discount_value+=(dataItems[i].qty*dataItems[i].unit_cost*(dataItems[i].unit_discount/100));\r\n                        discount_value_2+=((dataItems[i].qty*dataItems[i].unit_cost-discount_value)*(dataItems[i].unit_discount_2/100));\r\n                        \r\n                        //discount_value_2+=(discount_value*(dataItems[i].unit_discount_2/100));\r\n                        \r\n                        if(dataItems[i].vat ==1){\r\n                            if(dataItems[i].unit_discount>0){\r\n                                tmp=((dataItems[i].qty*dataItems[i].unit_cost-dataItems[i].qty*dataItems[i].unit_cost*(dataItems[i].unit_discount/100))*(vatValue-1));\r\n                                vat_value+=tmp;\r\n                            }else{\r\n                                tmp=(dataItems[i].qty*dataItems[i].unit_cost*(vatValue-1));\r\n                                vat_value+=tmp;\r\n                            }\r\n                        }\r\n                        \r\n                        //alert(((dataItems[i].qty*dataItems[i].unit_cost-discount_value-discount_value_2+vat_value)*(dataItems[i].discount_after_vat/100)));\r\n                        if(dataItems[i].discount_after_vat>0){\r\n                            total_discount_after_vat+=((dataItems[i].qty*dataItems[i].unit_cost-discount_value-discount_value_2+vat_value)*(dataItems[i].discount_after_vat/100));\r\n                        }\r\n   \r\n                    }\r\n                    \r\n                  \r\n                    \$(\"#invoice_subtotal\").val(total);\r\n                 \r\n                    \$(\"#invoice_discount\").val(0);\r\n                    \r\n                    \$(\"#invoice_tax\").val(vat_value);\r\n                    \r\n                    // HEREEEEEEEE\r\n                    var tmptot = 0;\r\n                    var tmp_id =0;\r\n                    \$(\".total_sum\").each(function( index ) {\r\n                  \r\n                        tmp_id = \$(this).attr(\"id\").split(\"_\");\r\n                        \r\n                        tmptot+=parseFloat(\$(this).val().replace(/,/g , '')*\$(\"#qty_\"+tmp_id[6]).val().replace(/,/g , ''));\r\n                    });\r\n                    tmptot+=Total_more_not_applied_on_items_cost;\r\n                  \r\n                    \$(\"#invoice_total\").val(tmptot);\r\n\r\n                    \$(\".mask_format\").trigger('input');\r\n                    cleaves_class(\".cleavesf\",3);\r\n                }\r\n            \r\n            }\r\n            \r\n\r\n            \r\n            function calculate_unit_cost(id){\r\n                \$(\"#uc_\"+id).val(\$(\"#tc_\"+id).cleanVal()/\$(\"#qty_\"+id).val().replace(/,/g , ''));\r\n                total_invoice_values();\r\n                update_total_cost_after_disc_vat();\r\n            }\r\n            \r\n            function calculate_total_cost(id){\r\n                \$(\"#tc_\"+id).val(\$(\"#uc_\"+id).cleanVal()*\$(\"#qty_\"+id).val().replace(/,/g , ''));\r\n                \$(\".mask_format\").trigger('input');\r\n                cleaves_class(\".cleavesf\",3);\r\n            }\r\n            \r\n            function update_total_cost_after_disc_vat(id){\r\n                \r\n                \r\n                if (\$('#vat_'+id).is(':checked')) {\r\n                    if(apply_vat_sales_item==1){\r\n                        var t = \$(\"#uc_\"+id).val().replace(/,/g , '');\r\n                        t = t - (t*parseFloat(\$(\"#disc_\"+id).val()/100));\r\n                        t = t*vatValue;\r\n                        t = t + \$(\"#more_\"+id).val().replace(/,/g , '');\r\n                        \$(\"#unit_cost_after_discount_and_vat_\"+id).val(t);\r\n                        calculate_total_cost(id);\r\n                    }else{\r\n                        \$(\"#uc_\"+id).val((\$(\"#uc_\"+id).val().replace(/,/g , '')*vatValue).toFixed(2));\r\n                        \$(\"#uc_\"+id).trigger('input');\r\n                        \r\n                        var t = \$(\"#uc_\"+id).val().replace(/,/g , '');\r\n                        t = t - (t*parseFloat(\$(\"#disc_\"+id).val()/100));\r\n                        t = t + \$(\"#more_\"+id).val().replace(/,/g , '');\r\n                        \$(\"#unit_cost_after_discount_and_vat_\"+id).val(t);\r\n                        calculate_total_cost(id);\r\n                    }\r\n                }else{\r\n                }\r\n                \$(\".mask_format\").trigger('input');\r\n                cleaves_class(\".cleavesf\",3);\r\n            }\r\n            \r\n             var calculate_tmout = null;\r\n            function calculate(id){\r\n                if(\$(\"#auty_pb_qty\").is(':checked')){\r\n                    \$(\"#print_bar_\"+id).val(\$(\"#qty_\"+id).val().replace(/,/g , ''));\r\n                }\r\n\r\n                \$(\"#tc_\"+id).val((parseFloat(\$(\"#uc_\"+id).val().replace(/,/g , '')))*parseFloat(\$(\"#qty_\"+id).val().replace(/,/g , '')));\r\n                var t = \$(\"#uc_\"+id).val().replace(/,/g , '');\r\n                t = t*(1-parseFloat(\$(\"#disc_\"+id).val()/100));\r\n                \r\n                t = t*(1-parseFloat(\$(\"#disc2_\"+id).val()/100));\r\n               \r\n                if (\$('#vat_'+id).is(':checked')) {\r\n  \r\n                    t = t*vatValue;\r\n                }\r\n\r\n                if (\$('#discAfterVat_'+id).val()!=\"\" && \$('#discAfterVat_'+id).val()>0) {\r\n                    t = t - (t*parseFloat(\$('#discAfterVat_'+id).val()/100));\r\n                }\r\n               \r\n                calculate_pi_more_per_item(id);\r\n                \r\n                t = t + parseFloat(\$(\"#more_\"+id).val());\r\n                \r\n                var charge=parseFloat(\$(\"#charge_\"+id).val());\r\n                if (isNaN(charge)) {\r\n                    charge=0;\r\n                }\r\n\r\n                if(\$('#charge_type_id').val()==1){\r\n                    t = t + parseFloat(charge);\r\n                }else{\r\n                    t = t + t*parseFloat(charge)/100;\r\n                }\r\n                \r\n                \r\n                \r\n                \$(\"#unit_cost_after_discount_and_vat_\"+id).val(t);\r\n                \r\n                //\$(\".mask_format\").trigger('input');\r\n                window.clearTimeout(calculate_tmout);\r\n                calculate_tmout = setTimeout(function(){\r\n                    total_invoice_values();\r\n                },50);\r\n                \r\n            }\r\n            \r\n            function addItemToInvoice(item_id,data){\r\n                var latest_cost = 0;\r\n                var free_qty = 0;\r\n                var disc_1 = 0;\r\n                var latest_discount = 0;\r\n                var latest_discount_2 = 0;\r\n                \r\n                var vat = 0;\r\n                var old_index = null;\r\n                \$.getJSON(\"?r=items&f=get_latest_cost_of_item&p0=\"+item_id, function (data) {\r\n                    if(data.length>0){\r\n                        latest_cost = data[0].cost;\r\n                        latest_discount = parseFloat(data[0].discount_percentage);\r\n                        latest_discount_2 = parseFloat(data[0].discount_percentage_2);\r\n                    }\r\n                }).done(function () {\r\n                    var items = '';\r\n                    old_index = all_items_index;\r\n         \r\n                    var tmp_qty = 0;\r\n                    var unit_cost = 0;\r\n                    if(data.length>0){\r\n                        tmp_qty = data[0].qty;\r\n                        latest_cost = data[0].unit_cost;\r\n                        \r\n                        free_qty=data[0].free_qty;\r\n                        vat=data[0].vat;\r\n                                                \r\n                        disc_1=data[0].discount;\r\n                        if(disc_1>0){\r\n                            latest_discount=disc_1;\r\n                        }\r\n                        \r\n                    }\r\n                    \r\n                  \r\n                    \r\n                    items+='<div class=\"row stock_entry item_id_'+all_items_index+' check_uniq_'+item_id+'\" id=\"nrow_'+all_items_index+'\">\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">\\n\\\r\n                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-3\" style=\"text-align:center\"><i title=\"Edit\" class=\"glyphicon glyphicon-edit\" style=\"cursor:pointer;font-size:15px;margin-top:5px;\" onclick=\"edit_item_o('+item_id+')\"></i></div>\\n\\\r\n                            <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:center\"><i title=\"Duplicate\" class=\"glyphicon glyphicon-duplicate\" style=\"cursor:pointer;font-size:15px;margin-top:5px;\" onclick=\"editItem(\\'IT-'+item_id+'\\',1)\"></i></div>\\n\\\r\n                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-3\" style=\"text-align:center\"><input type=\"hidden\" name=\"expiry_hidden_'+all_items_index+'\" id=\"expiry_hidden_'+all_items_index+'\" value=\"\" /><i id=\"ic_exp_'+all_items_index+'\" class=\"glyphicon glyphicon-time tooltip_exp\" style=\"cursor:pointer;font-size:15px;margin-top:5px;\" onclick=\"show_expiry('+item_id+')\" data-container=\"body\" data-container=\"body\" data-toggle=\"tooltip_expiry_'+item_id+'\" data-placement=\"top\"></i></div>\\n\\\r\n                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-3 itcodes\" style=\"text-align:center\"><i onclick=\"create_unique_items_for_item('+item_id+', 0)\" title=\"Item Codes\" class=\"glyphicon glyphicon-equalizer iconpic \"></i></div>\\n\\\r\n                            <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"display:none\"><select style=\"width:100%\" id=\"item_id_'+all_items_index+'\" onchange=\"updateOtherInfo('+all_items_index+')\"><option value=\"'+item_id+'\" title=\"'+item_id+'\">'+item_id+'</option></select></div>\\n\\\r\n                        </div>\\n\\\r\n                        <div style=\"display:none\" class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input type=\"text\" value=\"\" id=\"supref_'+all_items_index+'\" /></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" id=\"desc_'+all_items_index+'\"><div class=\"col-lg-10 col-md-10 col-sm-10 col-xs-10\"><input disabled=\"disabled\" type=\"text\" value=\"\" id=\"description_'+all_items_index+'\" /></div><div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\"></div></div>\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><div class=\"col-lg-7 col-md-7 col-sm-7 col-xs-7\"><input  type=\"text\" oninput=\"calculate('+all_items_index+')\" name=\"qty_'+all_items_index+'\" id=\"qty_'+all_items_index+'\" value=\"'+tmp_qty+'\" class=\"qqty cleavesf\" /></div><div class=\"col-lg-5 col-md-5 col-sm-5 col-xs-5\"><input type=\"text\" name=\"fqty_'+all_items_index+'\" id=\"fqty_'+all_items_index+'\" value=\"'+free_qty+'\" class=\"qqty cleavesf\" /></div></div>\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input class=\"cleavesf tot_bcg\" type=\"text\" onkeyup=\"calculate('+all_items_index+')\" name=\"uc_'+all_items_index+'\" id=\"uc_'+all_items_index+'\" value=\"'+latest_cost+'\" /></div>\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input class=\"cleavesf _readony tot_bcg\" readonly type=\"text\" name=\"tc_'+all_items_index+'\" id=\"tc_'+all_items_index+'\" value=\"0\" /></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\">\\n\\\r\n                            <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\"><input type=\"number\" oninput=\"calculate('+all_items_index+')\" name=\"disc_'+all_items_index+'\" min=\"0\" max=\"100\" id=\"disc_'+all_items_index+'\" value=\"'+latest_discount+'\" /></div>\\n\\\r\n                            <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"display:none\"><input type=\"number\" oninput=\"calculate('+all_items_index+')\" name=\"disc2_'+all_items_index+'\" min=\"0\" max=\"100\" id=\"disc2_'+all_items_index+'\" value=\"'+latest_discount_2+'\" /></div>\\n\\\r\n                            <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\" style=\"text-align:center\"><input type=\"checkbox\" onchange=\"calculate('+all_items_index+')\" name=\"vat\" id=\"vat_'+all_items_index+'\" style=\"height:21px;\"></div>\\n\\\r\n                            <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:center\"><input type=\"number\" oninput=\"calculate('+all_items_index+')\" min=\"0\" max=\"100\" name=\"discAfterVat_'+all_items_index+'\" id=\"discAfterVat_'+all_items_index+'\" value=\"0\" class=\"disavat\" /></div>\\n\\\r\n                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"text-align:center\"><input readonly=\"readonly\" type=\"text\" oninput=\"\" id=\"more_'+all_items_index+'\" value=\"0\" style=\"width:100%\" class=\"more_val\" /></div>\\n\\\r\n                            <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\"><input type=\"number\" oninput=\"calculate('+all_items_index+')\" name=\"charge_'+all_items_index+'\" id=\"charge_'+all_items_index+'\" value=\"0\" /></div>\\n\\                            \\n\\\r\n                        </div>\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input readonly=\"readonly\" type=\"text\" class=\"cleavesf tot_bcg _readony total_sum\" name=\"unit_cost_after_discount_and_vat_'+all_items_index+'\" id=\"unit_cost_after_discount_and_vat_'+all_items_index+'\" value=\"0\" /></div>\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-2\" style=\"text-align:center\">\\n\\\r\n                            <div class=\"col-lg-8 col-md-8 col-sm-8 col-xs-8\" style=\"text-align:center\"><input type=\"number\" value=\"0\" class=\"print_bar\" id=\"print_bar_'+all_items_index+'\" /></div>\\n\\\r\n                            <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\" style=\"text-align:center\"><i class=\"glyphicon glyphicon-trash trash_icon\" onclick=\"deleteItem('+all_items_index+')\" style=\"margin-top:2px;\"></i></div>\\n\\\r\n                        </div>\\n\\\r\n                    </div>';\r\n                    \$(\"#items_body\").append(items);\r\n                    \r\n                    if(vat==1){\r\n                        \$(\"#vat_\"+all_items_index).prop(\"checked\", true);\r\n                    }\r\n                    \r\n                    if(mobile_shop==0){\r\n                        \$(\".itcodes\").hide();\r\n                    }\r\n                    \r\n                    if(hide_cost==1){\r\n                        \$('#uc_'+all_items_index).hide();\r\n                        \$('#unit_cost_after_discount_and_vat_'+all_items_index).hide();\r\n                        \$('#tc_'+all_items_index).hide();   \r\n                    }\r\n                \r\n                    //\$(\"#qty_\"+all_items_index).numeric();\r\n                    \$(\"#disc_\"+all_items_index).numeric();\r\n                    \$(\"#discAfterVat_\"+all_items_index).numeric();\r\n                    \r\n                    cleaves_class(\".cleavesf\",3);\r\n                    \r\n                    calculate(all_items_index);\r\n                    \r\n                    \$('#items_body').scrollTop(\$('#items_body')[0].scrollHeight);\r\n\r\n                    all_items_index++;\r\n                    all_items_index_array.push(all_items_index);\r\n                    \r\n                    \r\n                    if(hide_cost==1){\r\n                        \$('#uc_'+all_items_index).hide();\r\n                        \$('#unit_cost_after_discount_and_vat_'+all_items_index).hide();\r\n                        \$('#tc_'+all_items_index).hide();   \r\n                    }\r\n                  \r\n                    \r\n                    updateOtherInfo(old_index,item_id);\r\n                    \r\n                    return old_index;\r\n                }); \r\n            }\r\n            \r\n            \r\n            function edit_item_o(id){\r\n                editItem(\"00-\"+id,0);\r\n            }\r\n            \r\n            function addItemToInvoiceToUpdate(infoStock){\r\n                var tmp_expiry_date = \"\";\r\n                if(infoStock.expiry_date==\"0000-00-00\"){\r\n                    tmp_expiry_date=\"\";\r\n                }else{\r\n                    tmp_expiry_date=infoStock.expiry_date;\r\n                }\r\n                var items = '';\r\n                items+='<div class=\"row stock_entry check_uniq_'+infoStock.item_id+'\" id=\"row_'+infoStock.id+'\">\\n\\\r\n                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">\\n\\\r\n                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-3\" style=\"text-align:center\"><i title=\"Edit\" class=\"glyphicon glyphicon-edit\" style=\"cursor:pointer;font-size:15px;margin-top:5px;\" onclick=\"edit_item_o('+infoStock.item_id+')\"></i></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:center\"><i title=\"Duplicate\" class=\"glyphicon glyphicon-duplicate\" style=\"cursor:pointer;font-size:15px;margin-top:5px;\" onclick=\"editItem(\\'IT-'+infoStock.item_id+'\\',1)\"></i></div>\\n\\\r\n                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-3\" style=\"text-align:center\"><input type=\"hidden\" name=\"expiry_hidden_'+infoStock.id+'\" id=\"expiry_hidden_'+infoStock.id+'\" value=\"'+tmp_expiry_date+'\" /><i id=\"ic_exp_'+infoStock.id+'\" class=\"glyphicon glyphicon-time tooltip_exp\" style=\"cursor:pointer;font-size:15px;margin-top:5px;\" onclick=\"show_expiry('+infoStock.id+')\" data-container=\"body\" data-toggle=\"tooltip_expiry_'+infoStock.id+'\" data-placement=\"top\"></i></div>\\n\\\r\n                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-3 itcodes\" style=\"text-align:center\"><i onclick=\"create_unique_items_for_item('+infoStock.item_id+', 0)\" title=\"Item Codes\" class=\"glyphicon glyphicon-equalizer iconpic\"></i></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"display:none\"><select style=\"width:100%\" id=\"item_id_'+infoStock.id+'\" onchange=\"updateOtherInfo('+infoStock.id+')\"><option value=\"'+infoStock.item_id+'\" title=\"'+infoStock.item_id+'\">'+infoStock.item_id+'</option></select></div>\\n\\\r\n                    </div>\\n\\\r\n                    <div style=\"display:none\" class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input type=\"text\" value=\"\" id=\"supref_'+infoStock.id+'\" /></div>\\n\\\r\n                    <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\"><div class=\"col-lg-10 col-md-10 col-sm-10 col-xs-10\"  id=\"desc_'+infoStock.id+'\"></div><div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2 returned_debit\">'+infoStock.returned_debit+'</div></div>\\n\\\r\n                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><div class=\"col-lg-7 col-md-7 col-sm-7 col-xs-7\"><input type=\"text\" oninput=\"calculate('+infoStock.id+')\" name=\"qty_'+infoStock.id+'\" id=\"qty_'+infoStock.id+'\" value=\"0\" class=\"qqty cleavesf\" /></div><div class=\"col-lg-5 col-md-5 col-sm-5 col-xs-5\"><input type=\"text\" oninput=\"\" name=\"\" id=\"fqty_'+infoStock.id+'\" value=\"0\" class=\"qqty cleavesf\" /></div></div>\\n\\\r\n                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input class=\"cleavesf tot_bcg\" type=\"text\" onkeyup=\"calculate('+infoStock.id+')\" name=\"uc_'+infoStock.id+'\" id=\"uc_'+infoStock.id+'\" value=\"0\" /></div>\\n\\\r\n                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input class=\"cleavesf tot_bcg _readony\" type=\"text\" readonly name=\"tc_'+infoStock.id+'\" id=\"tc_'+infoStock.id+'\" value=\"0\" /></div>\\n\\\r\n                    <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\">\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\"><input type=\"number\" oninput=\"calculate('+infoStock.id+')\" name=\"disc_'+infoStock.id+'\" min=\"0\" max=\"100\" id=\"disc_'+infoStock.id+'\" value=\"0\" /></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"display:none\"><input type=\"number\" oninput=\"calculate('+infoStock.id+')\" name=\"disc2_'+infoStock.id+'\" min=\"0\" max=\"100\" id=\"disc2_'+infoStock.id+'\" value=\"0\" /></div>\\n\\\r\n                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\" style=\"text-align:center\"><input type=\"checkbox\" onchange=\"calculate('+infoStock.id+')\" name=\"vat\" id=\"vat_'+infoStock.id+'\" style=\"height:21px;\"></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:center\"><input type=\"number\" oninput=\"calculate('+infoStock.id+')\" min=\"0\" max=\"100\" name=\"discAfterVat_'+infoStock.id+'\" id=\"discAfterVat_'+infoStock.id+'\" value=\"0\" class=\"disavat\" /></div>\\n\\\r\n                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"text-align:center\"><input readonly=\"readonly\" type=\"text\" oninput=\"\" id=\"more_'+infoStock.id+'\" value=\"0\" style=\"width:100%\" class=\"more_val\" /></div>\\n\\\r\n                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\"><input type=\"number\" oninput=\"calculate('+infoStock.id+')\" name=\"charge_'+infoStock.id+'\" id=\"charge_'+infoStock.id+'\" value=\"0\" /></div>\\n\\\r\n                    </div>\\n\\\r\n                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\"><input readonly=\"readonly\" class=\"cleavesf tot_bcg _readony total_sum\" type=\"text\" name=\"unit_cost_after_discount_and_vat_'+infoStock.id+'\" id=\"unit_cost_after_discount_and_vat_'+infoStock.id+'\" value=\"0\" /></div>\\n\\\r\n                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-2\" style=\"text-align:center\">\\n\\\r\n                        <div class=\"col-lg-8 col-md-8 col-sm-8 col-xs-8\" style=\"text-align:center\"><input type=\"number\" value=\"0\" class=\"print_bar\" id=\"print_bar_'+infoStock.id+'\" /></div>\\n\\\r\n                        <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\" style=\"text-align:center;\"><i class=\"glyphicon glyphicon-trash trash_icon del_c\" onclick=\"deleteItem('+infoStock.id+')\" style=\"margin-top:2px;\"></i></div>\\n\\\r\n                    </div>\\n\\\r\n                </div>';\r\n                \$(\"#items_body\").append(items);\r\n                //\$(\"#qty_\"+infoStock.id).numeric();\r\n                //\$(\"#disc_\"+all_items_index).numeric();\r\n                //\$(\"#discAfterVat_\"+all_items_index).numeric();\r\n                \r\n                \r\n                if(mobile_shop==0){\r\n                    \$(\".itcodes\").hide();\r\n                }\r\n                \r\n                \r\n                \r\n                \r\n                \$('#items_body').scrollTop(\$('#items_body')[0].scrollHeight);\r\n\r\n                \$('#desc_'+infoStock.id).html(infoStock.description);\r\n                \r\n                \$('#item_id_'+infoStock.id).val(infoStock.item_id);\r\n                \$('#qty_'+infoStock.id).val(infoStock.qty);\r\n                \$('#fqty_'+infoStock.id).val(infoStock.fqty);\r\n\r\n                \r\n                \$(\".mask_format\").mask(get_decimal_format(\$(\"#currency_id\").val()), {reverse: true});\r\n                cleaves_class(\".cleavesf\",3);\r\n                \r\n                \r\n                \$('#uc_'+infoStock.id).val(parseFloat(infoStock.cost));\r\n                \r\n                if(hide_cost==1){\r\n                    \$('#uc_'+infoStock.id).hide();\r\n                    \$('#unit_cost_after_discount_and_vat_'+infoStock.id).hide();\r\n                    \$('#tc_'+infoStock.id).hide();   \r\n                }\r\n                \r\n                \r\n                \r\n                \$('#disc_'+infoStock.id).val(parseFloat(infoStock.discount));\r\n                \$('#disc2_'+infoStock.id).val(parseFloat(infoStock.discount_2));\r\n                \$('#charge_'+infoStock.id).val(parseFloat(infoStock.charge));\r\n                \r\n                \$('#discAfterVat_'+infoStock.id).val(parseFloat(infoStock.discount_av));\r\n                \r\n                \$('#supref_'+infoStock.id).val(infoStock.supplier_item_ref);\r\n                \r\n                \$('#store_id_'+infoStock.id).val(infoStock.store_id);\r\n                \r\n                \$(\"#vat_\"+infoStock.id).click(function() {\r\n                    \r\n                });\r\n       \r\n                if(infoStock.vat==1){\r\n                    \$('#vat_'+infoStock.id).prop( \"checked\", true );\r\n                }\r\n                \r\n                calculate(infoStock.id);\r\n                \r\n                all_items_index_array.push(infoStock.id);   \r\n            }\r\n            \r\n            function autofill(){\r\n                if(\$(\"#autofill_id\").val()==\"0\"){\r\n                    \$(\"#invoice_subtotal\").prop('readonly', false);\r\n                    \$(\"#invoice_discount\").prop('readonly', false);\r\n                    \$(\"#invoice_tax\").prop('readonly', false);\r\n                    \$(\"#invoice_total\").prop('readonly', false);\r\n                }else{\r\n                    total_invoice_values();\r\n                    \$(\"#invoice_subtotal\").prop('readonly', true);\r\n                    \$(\"#invoice_discount\").prop('readonly', true);\r\n                    \$(\"#invoice_tax\").prop('readonly', true);\r\n                    \$(\"#invoice_total\").prop('readonly', true);\r\n                    \r\n                }\r\n            }\r\n            \r\n            function submit_upload(){\r\n                \$(\"#pi_picture_form\").submit();\r\n            }\r\n            \r\n            function expiry_changed(id){\r\n                \$(\"#expiry_hidden_\"+id).val(\$(\"#pcker_tooltip_\"+id).val());\r\n            }\r\n            \r\n            function show_expiry(id){\r\n                \$('[data-toggle=\"tooltip_expiry_'+id+'\"]').attr('data-original-title', \"<input onchange='expiry_changed(\"+id+\")' class='expiry_tooltip' name='' id='pcker_tooltip_\"+id+\"' type='text' />\").tooltip({trigger: 'manual',html:true}).tooltip('toggle');\r\n                \$('[data-toggle=\"tooltip_expiry_'+id+'\"]').on('shown.bs.tooltip', function () {\r\n                   \$(\"#pcker_tooltip_\"+id).datepicker({autoclose:true,format: 'yyyy-mm-dd'});\r\n                   if(\$(\"#expiry_hidden_\"+id).val().length>0){\r\n                       \$(\"#pcker_tooltip_\"+id).datepicker(\"setDate\" , \$(\"#expiry_hidden_\"+id).val());\r\n                   }\r\n                });\r\n            }\r\n            \r\n            \r\n            function delete_picture_pi(id){\r\n                swal({\r\n                    title: \"Are you sure?\",\r\n                    text: \"\",\r\n                    type: \"warning\",\r\n                    showCancelButton: true,\r\n                    confirmButtonClass: \"btn-danger\",\r\n                    confirmButtonText: \"Yes\",\r\n                    closeOnConfirm: true,\r\n                    cancelButtonText: \"Cancel\", \r\n                },\r\n                function(isConfirm){\r\n                    if(isConfirm){\r\n                       \$(\".sk-circle-layer\").show();\r\n                        \$.getJSON(\"?r=stock&f=delete_picture_pi&p0=\"+id, function (data) {\r\n                            var upload = '\\n\\\r\n                                <form id=\"pi_picture_form\" action=\"\" method=\"post\" enctype=\"multipart/form-data\" >\\n\\\r\n                                <div class=\"form-group\" >\\n\\\r\n                                    <label for=\"mof\">PI Picture</label>\\n\\\r\n                                    <input type=\"hidden\" value=\"'+id+'\" class=\"form-control\"  id=\"pi_id_for_pic\" name=\"pi_id_for_pic\">\\n\\\r\n                                    <input onchange=\"submit_upload()\" accept=\".png,.jpg,.jpeg\" type=\"file\" value=\"\" class=\"form-control\"  id=\"pi_picture\" name=\"pi_picture\">\\n\\\r\n                                </div>\\n\\\r\n                            </form>';\r\n                            \$(\"#pic_upload\").empty();\r\n                            \$(\"#pic_upload\").append(upload);\r\n                            update_pi_picture_submit();\r\n                        }).done(function () {\r\n                            \$(\".sk-circle-layer\").hide();\r\n                        }); \r\n                    }\r\n                });\r\n            }\r\n            \r\n            function import_items_of_supplier(){\r\n                if(\$(\"#supplier_id\").val()==0){\r\n                    swal(\"Select Supplier First\");\r\n                }else{\r\n                    \$(\".sk-circle-layer\").show();\r\n                    \$.getJSON(\"?r=items&f=import_items_of_supplier&p0=\"+\$(\"#supplier_id\").val(), function (data) {\r\n                        \$.each(data, function (key, val) {\r\n                            if(\$(\".check_uniq_\"+val.item_id).length==0){\r\n                                addItemToInvoice(val.item_id,[]);\r\n                            }\r\n                        });\r\n                    }).done(function () {\r\n                        \$(\".sk-circle-layer\").hide();\r\n                    }); \r\n                }\r\n            }\r\n            \r\n            function add_discount_after_vat(){\r\n                swal({\r\n                    title: \"Enter Discount Value\",\r\n                    html: true ,\r\n                    text: '<input class=\"form-control\" value=\"\" type=\"text\" id=\"pass\"/>',\r\n                    showCancelButton: true,\r\n                    confirmButtonClass: \"btn-danger\",\r\n                    confirmButtonText: \"Ok\",\r\n                    cancelButtonText: \"Cancel\",\r\n                    closeOnConfirm: true,\r\n                    closeOnCancel: true\r\n                },\r\n                function(isConfirm) {\r\n                    if (isConfirm) {\r\n                        \$( \".disavat\" ).each(function( index ) {\r\n                            \$(\"#discAfterVat_\"+\$(this).attr(\"id\").split('_')[1]).val(\$(\"#pass\").val());\r\n                            calculate(\$(this).attr(\"id\").split('_')[1]);\r\n                        });\r\n                        \r\n                    }\r\n                });\r\n                setTimeout(function(){ \$(\"#pass\").numeric();\$(\"#pass\").focus(); },200);\r\n            }\r\n            \r\n            \r\n            function update_currency_label_to(){\r\n                for(var i=0;i<all_currencies.length;i++){\r\n                    if(all_currencies[i].id!=\$(\"#currency_id\").val() ){\r\n                        //\$(\"#pi_to_cur\").html(all_currencies[i].symbole);\r\n                    }\r\n                }\r\n            }\r\n            \r\n            function update_currency_pi(pi_id){\r\n            \r\n                if(\$(\"#currency_id\").val()!=1 && \$(\"#currency_id\").val()!=2){\r\n                    for(var i=0;i<all_currencies.length;i++){\r\n                        if(all_currencies[i].id==\$(\"#currency_id\").val()){\r\n                            \$(\"#pi_to_cur\").html(all_currencies[i].symbole);\r\n                        }\r\n                    }\r\n                }else{\r\n                    \$(\"#pi_to_cur\").html(\"LBP\");\r\n                }\r\n                \r\n                \$(\".sk-circle-layer\").show();\r\n                \$.getJSON(\"?r=stock&f=update_currency_pi&p0=\"+pi_id+\"&p1=\"+\$(\"#currency_id\").val(), function (data) {\r\n               \r\n                    \$(\"#cur_rate\").val(data);\r\n                }).done(function () {\r\n                    \$(\".mask_format\").mask(get_decimal_format(\$(\"#currency_id\").val()), {reverse: true});\r\n                    cleaves_class(\".cleavesf\",3);\r\n                    \$(\".sk-circle-layer\").hide();\r\n                }); \r\n            }\r\n            \r\n            function receive_stock_modal(action_type,btn_action_name,info,infoStock){\r\n                var btn_disabled = \"\";\r\n                var input_read_only = \"\";\r\n                if(action_type>0){\r\n                    //btn_disabled=\"disabled\";\r\n                    //input_read_only=\"readonly\";\r\n                }\r\n                \r\n                var hide_save = \"display:block;\";\r\n                if(info.moved_to_stock==1){\r\n                    hide_save = \"display:none;\";\r\n                }\r\n                \r\n                \r\n                if(info[\"deleted\"]==1){\r\n                    hide_save = \"display:none;\";\r\n                }\r\n                \r\n                var upload = \"\\n\\\r\n                    <div class='row'>\\n\\\r\n                        <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>\\n\\\r\n                            <div class='row form-group'>\\n\\\r\n                                <label for='delivery_date'>PI Picture <a href='\"+info.pi_pic_path+\"' data-toggle='lightbox' id='open-image' data-title='&nbsp;' data-footer='&nbsp;'>Show</a></label>\\n\\\r\n                                <button id='delete_pi_pic' onclick='delete_picture_pi(\"+action_type+\")' type='button' class='btn btn-danger' style='width:100%'>Delete</button>\\n\\\r\n                            </div>\\n\\\r\n                        </div>\\n\\\r\n                    </div>\\n\\\r\n                \";\r\n                if(info.pi_pic_exist==0){\r\n                    upload = '\\n\\\r\n                        <form id=\"pi_picture_form\" action=\"\" method=\"post\" enctype=\"multipart/form-data\" >\\n\\\r\n                        <div class=\"form-group\" >\\n\\\r\n                            <label for=\"mof\">PI Picture</label>\\n\\\r\n                            <input type=\"hidden\" value=\"'+action_type+'\" class=\"form-control\"  id=\"pi_id_for_pic\" name=\"pi_id_for_pic\">\\n\\\r\n                            <input onchange=\"submit_upload()\" accept=\".png,.jpg,.jpeg\" type=\"file\" value=\"\" class=\"form-control\"  id=\"pi_picture\" name=\"pi_picture\">\\n\\\r\n                        </div>\\n\\\r\n                    </form>';\r\n                }\r\n                var content =\r\n                '<div class=\"modal\" data-keyboard=\"false\" data-backdrop=\"static\" id=\"receive_stockModal\" role=\"dialog\" aria-labelledby=\"payment_info__\" aria-hidden=\"true\">\\n\\\r\n                    <div class=\"modal-dialog\" role=\"document\">\\n\\\r\n                        <div class=\"modal-content\">\\n\\\r\n                            <div class=\"modal-header\"> \\n\\\r\n                                <h3 class=\"modal-title\"><i class=\"glyphicon glyphicon-plus\"></i>Purchase Invoice</h3> <input type=\"file\" class=\"form-control-file\" id=\"excelfile\" onchange=\"ReadExcelSheetPI()\">\\n\\\r\n                            </div>\\n\\\r\n                            <div class=\"modal-body\">\\n\\\r\n                                <input id=\"action_type\" value=\"'+action_type+'\" name=\"action_type\" type=\"hidden\" />\\n\\\r\n                                <div class=\"row\">\\n\\\r\n                                    <div class=\"col-lg-2 col-md-6 col-sm-6 col-xs-6 plr2\">\\n\\\r\n                                        <div class=\"col-lg-7 col-md-7 col-sm-7 col-xs-7\">\\n\\\r\n                                            <div class=\"row form-group\">\\n\\\r\n                                                <label for=\"supplier_id\">Suppliers</label>&nbsp;<span class=\"linkadd\" onclick=\"addSupplier(\\'receive_stock\\')\">Add New</span>\\n\\\r\n                                                <select data-live-search=\"true\" id=\"supplier_id\" class=\"form-control selectpicker\" data-size=\"10\" onchange=\"supplier_changed()\">'+getOptionsSuppliers()+'</select>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div style=\"'+hide_save+'\" class=\"col-lg-5 col-md-5 col-sm-5 col-xs-5\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"supplier_id\">&nbsp;</label>\\n\\\r\n                                                <button type=\"button\" class=\"btn '+btn_disabled+'\" onclick=\"import_items_of_supplier()\" style=\"width:100%; font-size:16px !important;padding:3px;\"><i class=\"glyphicon glyphicon-plus\"></i>&nbsp;Import</button>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6 plr2\" style=\"margin-bottom:1px;\">\\n\\\r\n                                        <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"invoice_reference\">PI number</label>\\n\\\r\n                                                <input id=\"invoice_reference\" value=\"\" name=\"invoice_reference\" type=\"text\" class=\"form-control\"/>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"invoice_date\">PI Date</label>\\n\\\r\n                                                <input id=\"invoice_date\" value=\"\" name=\"invoice_date\" type=\"text\" class=\"form-control datepicker\"/>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"delivery_date\">Received</label>\\n\\\r\n                                                <input id=\"delivery_date\" value=\"\" name=\"delivery_date\" type=\"text\" class=\"form-control datepicker\"/>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-6 plr2\" id=\"ri_rate\" style=\"display:none\" >\\n\\\r\n                                        <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\"><div class=\"row form-group plr2\">\\n\\\r\n                                            <label for=\"currency_id\">Currency</label>\\n\\\r\n                                            <select onchange=\"update_currency_pi('+action_type+')\" id=\"currency_id\" class=\"form-control selectpicker\" data-size=\"10\" onchange=\"currency_pi_changed()\">'+getOptionsCurrencies()+'</select>\\n\\\r\n                                        </div></div>\\n\\\r\n                                        <div class=\"col-lg-8 col-md-8 col-sm-8 col-xs-12 pl2 pr2\">\\n\\\r\n                                            <div class=\"form-group\" style=\"width:100%\">\\n\\\r\n                                                <label for=\"inv_rate\" style=\"width:100%\">Rate</label>\\n\\\r\n                                                <div class=\"input-group\" style=\"width:100%\">\\n\\\r\n                                                    <span class=\"input-group-addon\" style=\"width:40px;\"><b id=\"pi_from_cur\">1 USD </b>= </span>\\n\\\r\n                                                        <input type=\"text\" class=\"form-control cleavesf\" name=\"cur_rate\" id=\"cur_rate\" value=\"1500\" placeholder=\"\" style=\"padding-left:5px;padding-right:5px;font-weight:bold;\" />\\n\\\r\n                                                    <span class=\"input-group-addon\" style=\"width:40px;\"><b id=\"pi_to_cur\">LBP</b></span>\\n\\\r\n                                                </div>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2 plr2\" id=\"pic_upload\">'+upload+'</div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                        <div class=\"form-group\">\\n\\\r\n                                            <label for=\"delivery_date\">&nbsp;</label>\\n\\\r\n                                            <button type=\"button\" class=\"btn\" onclick=\"show_pi_logs('+action_type+')\" style=\"width:100%; font-size:16px !important;padding:3px;\">Show Logs</button>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                               </div>\\n\\\r\n                               <div class=\"row\">\\n\\\r\n                                    <div style=\"'+hide_save+'\" class=\"col-lg-3 col-md-8 col-sm-8 col-xs-8\">\\n\\\r\n                                        <div class=\"row\">\\n\\\r\n                                         <label for=\"autofill_id\">Search Item to add</label>\\n\\\r\n                                            <input '+input_read_only+' type=\"text\" class=\"form-control input-md\" id=\"search_by_name\" style=\"height:29px;\" placeholder=\"Search Name - Barcode - Id\" />\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div style=\"'+hide_save+'\" class=\"col-lg-2 col-md-4 col-sm-4 col-xs-4\">\\n\\\r\n                                        <div class=\"row\">\\n\\\r\n                                            <label for=\"autofill_id\">&nbsp;</label>\\n\\\r\n                                            <button type=\"button\" class=\"btn '+btn_disabled+'\" onclick=\"define_new_items(\\'receive_stock\\')\" style=\"width:100%; font-size:16px !important;padding:3px;\"><i class=\"glyphicon glyphicon-plus\"></i>&nbsp;Define New Item</button>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                        <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"autofill_id\">Autofill</label>\\n\\\r\n                                                <select id=\"autofill_id\" class=\"form-control selectpicker\" data-size=\"10\" onchange=\"autofill()\"><option value=\"0\">Disable</option><option value=\"1\" selected>Enable</option></select>\\n\\\r\n                                            </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                        <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"charge_type_id\">Charge Type</label>\\n\\\r\n                                                <select id=\"charge_type_id\" class=\"form-control selectpicker\" data-size=\"10\" onchange=\"\"><option value=\"1\">Amount</option><option value=\"2\">Percentage</option></select>\\n\\\r\n                                            </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-5 col-md-10 col-sm-10 col-xs-10\" style=\"padding-left:0px;\">\\n\\\r\n                                        <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"invoice_cost\">Subtotal&nbsp;</label><label class=\"currency_label\">('+default_currency_symbol+')</label></label>\\n\\\r\n                                                <input id=\"invoice_subtotal\" value=\"0\" name=\"invoice_subtotal\" type=\"text\" class=\"form-control tot_bcg cleavesf\" style=\"font-weight:bold;\" />\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"display:none\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"invoice_discount\">Discount&nbsp;</label><label class=\"currency_label\">('+default_currency_symbol+')</label>\\n\\\r\n                                                <input id=\"invoice_discount\" value=\"0\" name=\"invoice_discount\" type=\"text\" class=\"form-control tot_bcg cleavesf\" style=\"font-weight:bold;\"/>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"invoice_tax\">Total VAT&nbsp;</label><label class=\"currency_label\">('+default_currency_symbol+')</label></label>\\n\\\r\n                                                <input id=\"invoice_tax\" value=\"0\" name=\"invoice_tax\" type=\"text\" class=\"form-control tot_bcg cleavesf\" style=\"font-weight:bold;\" />\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\">\\n\\\r\n                                            <div class=\"row form-group plr2\">\\n\\\r\n                                                <label for=\"invoice_discount\">Total&nbsp;</label><label class=\"currency_label\">('+default_currency_symbol+')</label></label>\\n\\\r\n                                                <input id=\"invoice_total\" value=\"0\" name=\"invoice_total\" type=\"text\" class=\"form-control tot_bcg cleavesf\" style=\"font-weight:bold;\" />\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                           <div class=\"row\">\\n\\\r\n                                                <label for=\"autofill_id\">&nbsp;</label>\\n\\\r\n                                                <button type=\"button\" class=\"btn\" onclick=\"pi_more('+action_type+')\" style=\"width:100%; font-size:16px !important;padding:3px;\">On Invoice</button>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                </div>\\n\\\r\n                                <div class=\"row\">\\n\\\r\n                                </div>\\n\\\r\n                                <div class=\"row stock_entry_header\">\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">Item</div>\\n\\\r\n                                    <div style=\"display:none\" class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">SKU</div>\\n\\\r\n                                    <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\"><div class=\"col-lg-10 col-md-10 col-sm-10 col-xs-10\">Description</div><div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">Rtn.</div></div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">\\n\\\r\n                                        \\n\\\r\n                                        <div class=\"col-lg-7 col-md-7 col-sm-7 col-xs-7\">Qty</div>\\n\\\r\n                                        <div class=\"col-lg-5 col-md-5 col-sm-5 col-xs-5\">Free</div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">U. Cost</div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">T. Cost</div>\\n\\\r\n                                    <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\">\\n\\\r\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:left\">Disc 1 %</div>\\n\\\r\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:center;display:none\">Disc 2 %</div>\\n\\\r\n                                        <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\" style=\"text-align:left\">VAT</div>\\n\\\r\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:left\">Disc. %</div>\\n\\\r\n                                        <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"text-align:left;\">More</div>\\n\\\r\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"text-align:left\">Charge</div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">F. U. Cost</div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">\\n\\\r\n                                        <div class=\"col-lg-6 col-md-6 col-sm-1 col-xs-1\">P.B.&nbsp;<input onchange=\"auto_qty_changed()\" title=\"Auto Qty\" type=\"checkbox\" name=\"vat\" id=\"auty_pb_qty\"></div>\\n\\\r\n                                        <div class=\"col-lg-6 col-md-6 col-sm-1 col-xs-1\">&nbsp;</div>\\n\\\r\n                                    </div>\\n\\\r\n                                </div>\\n\\\r\n                                <div class=\"row\">\\n\\\r\n                                    <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\" id=\"items_body\">\\n\\\r\n                                    </div>\\n\\\r\n                                </div>\\n\\\r\n                                <div class=\"row\" style=\"margin-top:5px;display:none;\">\\n\\\r\n                                    <div class=\"col-lg-11 col-md-11 col-sm-11 col-xs-11\">\\n\\\r\n                                        <div class=\"row\">\\n\\\r\n                                            &nbsp;\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-1 col-md-1 col-sm-1 col-xs-1\">\\n\\\r\n                                        <div class=\"row\">\\n\\\r\n                                            <button type=\"button\" class=\"btn\" onclick=\"add_discount_after_vat()\" style=\"width:100%; font-size:16px !important;padding:3px;\">Disc. After VAT</button>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                </div>\\n\\\r\n                            </div>\\n\\\r\n                            <div class=\"modal-footer\">\\n\\\r\n                                <div class=\"row\">\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                        <button type=\"button\" class=\"btn btn-primary\"  style=\"width:100%; font-size:22px !important;padding:0px;'+hide_save+'\" id=\"receive_stock_btn\" onclick=\"getAllReceiveStock(1)\">'+btn_action_name+'</button>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\">\\n\\\r\n                                        <button type=\"button\" class=\"btn btn-danger\"  style=\"width:100%; font-size:22px !important;padding:0px;\" onclick=\"closeReceiveStock('+info.moved_to_stock+')\">Close</button>\\n\\\r\n                                    </div>\\n\\\r\n                                </div>\\n\\\r\n                            </div>\\n\\\r\n                        </div>\\n\\\r\n                    </div>\\n\\\r\n                </div>';\r\n                \$(\"#receive_stockModal\").remove();\r\n                \$(\"body\").append(content);\r\n                \r\n                \$(\"#receive_stockModal\").centerWH();\r\n                \r\n                \$(\".selectpicker\").selectpicker({style: 'btn-default'});\r\n                if(info[\"supplier_id\"]!=null){\r\n                    \$('#supplier_id').selectpicker('val', info[\"supplier_id\"]);\r\n                }\r\n                \r\n                \r\n                \$('.datepicker').datepicker({autoclose:true,format: 'yyyy-mm-dd'});\r\n\r\n                if(info[\"receive_invoice_date\"]!=null){\r\n                    \$('#invoice_date').datepicker( \"setDate\", info[\"receive_invoice_date\"]);\r\n                }else{\r\n                    \$('#invoice_date').datepicker( \"setDate\", new Date());\r\n                }\r\n                if(info[\"delivery_date\"]!=null){\r\n                    \$('#delivery_date').datepicker( \"setDate\", info[\"delivery_date\"]);\r\n                }else{\r\n                    \$('#delivery_date').datepicker( \"setDate\", new Date());\r\n                }\r\n                \r\n                if(info[\"invoice_reference\"]!=null){\r\n                    \$('#invoice_reference').val(info[\"invoice_reference\"]);\r\n                }\r\n                \r\n                \r\n                \$('#currency_id').selectpicker('val', info[\"currency_id\"]);\r\n                update_currency_label_to();\r\n                \r\n                \r\n                \r\n                \r\n                var cur_to_round=1/info[\"cur_rate\"];\r\n                \r\n                //alert(info[\"cur_rate\"]);\r\n                //(\"#cur_rate\").val( (Math.round(cur_to_round * 1000) / 1000) );\r\n                \$(\"#cur_rate\").val(info[\"cur_rate\"]);\r\n\r\n                \r\n                \r\n                \$(\".only_numeric\").numeric({ negative : false});\r\n                \r\n                \$('.datepicker').datepicker().on('changeDate', function(ev) {\r\n\r\n                }).on('hide show', function(event) {\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                });\r\n                \r\n                \r\n                \r\n                \$('#receive_stockModal').on('shown.bs.modal', function (e) {\r\n                    \r\n                    \$('#open-image').click(function (e) {\r\n                        e.preventDefault();\r\n                        \$(this).ekkoLightbox();\r\n                    });\r\n            \r\n                    update_pi_picture_submit();\r\n                    \r\n                    \r\n                    if(info[\"moved_to_stock\"]==1){\r\n                        \$(\"#receive_stockModal input\").attr(\"disabled\",\"disabled\");\r\n                        \$(\"#receive_stockModal select\").prop('disabled', 'disabled');\r\n                        \$(\"#delete_pi_pic\").prop('disabled', 'disabled');\r\n                    }\r\n                    \r\n                    if(only_1_currency==1){\r\n                        \$(\"#ri_rate\").hide();\r\n                    }\r\n                    \r\n                   \r\n                });\r\n                \r\n                \$('#receive_stockModal').on('show.bs.modal', function (e) {\r\n\r\n                    \$(\".mask_format\").mask(get_decimal_format(\$(\"#currency_id\").val()), {reverse: true});\r\n                    cleaves_class(\".cleavesf\",3);\r\n                    \r\n                    \$(\"#autofill_id\").val(info[\"auto_filled\"]);\r\n                    \$(\"#autofill_id\").selectpicker('refresh');\r\n                   \r\n                    \$(\"#charge_type_id\").val(info[\"charge_type\"]);\r\n                    \$(\"#charge_type_id\").selectpicker('refresh');                   \r\n                    \r\n                    \r\n                    if(info[\"auto_filled\"]==\"1\"){\r\n                        \$(\"#invoice_subtotal\").prop('readonly', true);\r\n                        \$(\"#invoice_discount\").prop('readonly', true);\r\n                        \$(\"#invoice_tax\").prop('readonly', true);\r\n                        \$(\"#invoice_total\").prop('readonly', true);\r\n                    }\r\n                \r\n                    \r\n                    //\$('#cur_rate').val(info[\"cur_rate\"]);\r\n                    \r\n                    for(var i=0;i<infoStock.length;i++){\r\n                        addItemToInvoiceToUpdate(infoStock[i]);\r\n                    }\r\n                    \r\n                    if(info[\"moved_to_stock\"]==1){\r\n                        \$(\".del_c\").hide();\r\n                    }\r\n                    \r\n                    type_ahead(\"?r=items&f=get_items_names_without_boxes\",\"search_by_name\");\r\n                    \r\n                    setTimeout(function(){\r\n                        calculate_pi_more_per_item();\r\n                    },500);\r\n                    \r\n                    if(info[\"auto_filled\"]==1){\r\n                        \r\n                        total_invoice_values();\r\n                    }else{\r\n                        //\$(\"#invoice_subtotal\").val(info[\"subtotal\"]);\r\n                        //\$(\"#invoice_discount\").val(info[\"discount\"]);\r\n                        //alert(get_decimal_to_fix(\$(\"#currency_id\").val()));\r\n                        \r\n                        \$(\"#invoice_total\").val(parseFloat(info[\"total\"]));\r\n                        \$(\"#invoice_subtotal\").val(parseFloat(info[\"subtotal\"]));\r\n                        \r\n                        \$(\"#invoice_discount\").val(parseFloat(info[\"discount\"]));\r\n                        \$(\"#invoice_tax\").val(parseFloat(info[\"invoice_tax\"]));\r\n                        //\$(\"#invoice_total\").val(info[\"total\"]);\r\n                        \r\n                        //\$(\"#invoice_tax\").val(info[\"invoice_tax\"]);\r\n                        \$(\".mask_format\").trigger('input');\r\n                        cleaves_class(\".cleavesf\",3);\r\n                    }\r\n                    \r\n                    \r\n                });\r\n                \$('#receive_stockModal').on('hide.bs.modal', function (e) {\r\n                    \$('.tooltip_exp').tooltip('destroy');\r\n                    \$('#receive_stockModal').remove();\r\n                    \r\n                    all_items_index = 0;\r\n                    all_items_index_array = [all_items_index];\r\n                });\r\n                \$('#receive_stockModal').modal('show');\r\n            }\r\n            \r\n            function auto_qty_changed(){\r\n                if(\$(\"#auty_pb_qty\").is(':checked')){\r\n                    \$(\".print_bar\").each(function( index ) {\r\n                        var print_b = \$(this).attr(\"id\").split(\"_\")[2];\r\n                        \$(this).val(\$(\"#qty_\"+print_b).val()); \r\n                    });\r\n                }else{\r\n                    \$(\".print_bar\").each(function( index ) {\r\n                        \$(this).val(0); \r\n                        \r\n                    });\r\n                }\r\n            }\r\n            \r\n            function update_pi_picture_submit(){\r\n                \$(\"#pi_picture_form\").on('submit', (function (e) {\r\n                    e.preventDefault();\r\n                    \$.ajax({\r\n                        url: \"?r=stock&f=update_pi_picture\",\r\n                        type: \"POST\",\r\n                        data: new FormData(this),\r\n                        contentType: false,\r\n                        cache: false,\r\n                        processData: false,\r\n                        dataType: 'json',\r\n                        success: function (data)\r\n                        {\r\n                            swal(\"Picture Uploaded\");\r\n                        }\r\n                    });\r\n                }));\r\n            }\r\n            \r\n            function currency_pi_changed(){\r\n                for(var i=0;i<all_currencies.length;i++){\r\n                    if(\$(\"#currency_id\").val()==all_currencies[i][\"id\"]){\r\n                        if(all_currencies[i].system_default==1){\r\n                            \$(\"#cur_rate\").val(\"1\");\r\n                            //\$(\"#cur_rate\").prop('readonly', true);\r\n                        }else{\r\n                            \r\n                            \$(\"#cur_rate\").val(all_currencies[i][\"rate_to_system_default\"]);\r\n                            //\$(\"#cur_rate\").prop('readonly', false);\r\n                        }\r\n                        \$(\".currency_label\").html(\"(\"+all_currencies[i][\"symbole\"]+\")\");\r\n                        \$(\".mask_format\").mask(get_decimal_format(\$(\"#currency_id\").val()), {reverse: true});\r\n                        cleaves_class(\".cleavesf\",3);\r\n                        return;\r\n                    }\r\n                }\r\n                \r\n            }\r\n            \r\n            function receive_stock(inv_id){\r\n                var action_type = 0;\r\n                var btn_action_name = \"Add\";\r\n                var info =[];\r\n                info[\"invoice_date\"] = null;\r\n                info[\"delivery_date\"] = null;\r\n                info[\"supplier_id\"] = null;\r\n                info[\"subtotal\"] = null;\r\n                \r\n                info[\"discount\"] = null;\r\n                info[\"discount_av\"] = null;\r\n                info[\"total\"] = null;\r\n                //info[\"paid_status\"] = null;\r\n                info[\"invoice_tax\"] = null;\r\n                var infoStock = [];\r\n                if(inv_id>0){\r\n                    action_type = inv_id;\r\n                    btn_action_name = \"Save\";\r\n                    \r\n                    \$.getJSON(\"?r=stock&f=getStockInvoicesById&p0=\"+inv_id, function (data) {\r\n                        \r\n                        Total_more = 0;\r\n                        Total_more_not_applied_on_items_cost = 0;\r\n                        \r\n                        current_pi_id = inv_id;\r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \$.each(data.pi_more_data, function (key, val) {\r\n                            if(val.type_id==1 && val.apply_to_pi==1){\r\n                                Total_more-=parseFloat(val.value);\r\n                            }\r\n                            if(val.type_id==2 && val.apply_to_pi==1){\r\n                                Total_more+=parseFloat(val.value);\r\n                            }\r\n                            \r\n                            if(val.type_id==1 && val.apply_to_pi==0){\r\n                                Total_more_not_applied_on_items_cost-=parseFloat(val.value);\r\n                            }\r\n                            if(val.type_id==2 && val.apply_to_pi==0){\r\n                                Total_more_not_applied_on_items_cost+=parseFloat(val.value);\r\n                            }\r\n                         });\r\n                        \r\n                         \r\n                        \$.each(data.invoice_info, function (key, val) {\r\n                            info[\"receive_invoice_date\"] = val.receive_invoice_date;\r\n                            info[\"delivery_date\"] = val.delivery_date;\r\n                            info[\"supplier_id\"] = val.supplier_id;\r\n                            info[\"subtotal\"] = val.subtotal;\r\n                            info[\"invoice_reference\"] = val.invoice_reference;\r\n                            info[\"currency_id\"] = val.currency_id;\r\n                            \r\n                            vatValue = val.vat;\r\n                            \r\n                            info[\"discount\"] = val.discount;\r\n                            \r\n                            info[\"total\"] = val.total;\r\n                            info[\"paid_status\"] = val.paid_status;\r\n                            info[\"invoice_tax\"] = val.invoice_tax;\r\n                            info[\"auto_filled\"] = val.auto_filled; \r\n                            info[\"charge_type\"] = val.charge_type; \r\n                \r\n                         \r\n                            info[\"cur_rate\"] = val.cur_rate; \r\n            \r\n                            info[\"pi_pic_exist\"] = val.pi_pic_exist; \r\n                            info[\"pi_pic_path\"] = val.pi_pic_path;\r\n                            \r\n       \r\n                            info[\"moved_to_stock\"] = val.moved_to_stock;\r\n                            \r\n                            info[\"deleted\"] = val.deleted;\r\n                            \r\n                            \r\n            \r\n                            \r\n                        });\r\n                        \$.each(data.invoice_items, function (key, val) {\r\n                            \r\n                            infoStock.push({id:val.id,item_id:val.item_id,qty:parseFloat(val.qty),cost:val.cost,description:val.description,vat:val.vat,supplier_item_ref:val.supplier_ref,discount:val.discount_percentage,discount_2:val.discount_percentage_2,store_id:val.location_id,discount_av:val.discount_after_vat,returned_debit:parseFloat(val.returned_debit),fqty:parseFloat(val.fqty),expiry_date:val.expiry_date,charge:val.charge});\r\n                        });\r\n                    }).done(function () {\r\n                        \$(\".sk-circle-layer\").hide();\r\n                        receive_stock_modal(action_type,btn_action_name,info,infoStock);\r\n                    }); \r\n                }else{\r\n                    receive_stock_modal(action_type,btn_action_name,info,infoStock);\r\n                }\r\n                \r\n            }\r\n            \r\n            \r\n            \r\n            function parseFloatOpts(num, decimal, thousands) {\r\n                var bits = num.split(decimal, 2),\r\n                ones = bits[0].replace(new RegExp('\\\\' + thousands, 'g'), '');\r\n                ones = parseFloat(ones, 10);\r\n                decimal = parseFloat('0.' + bits[1], 10);\r\n                return ones + decimal;\r\n            }\r\n            \r\n            function type_ahead(url,input_id){\r\n                \$(\".sk-circle-layer\").show();\r\n                \$.get(url, function(data){\r\n                    \$(\".sk-circle-layer\").hide();\r\n                    var \$input = \$(\"#\"+input_id);\r\n                    \$input.typeahead({\r\n                        source: data,\r\n                        autoSelect: true,\r\n                        fitToElement:false,\r\n                        items:\"all\",\r\n                        scrollHeight:0,\r\n                        minLength:2\r\n                    });\r\n                    \r\n                    \$input.change(function() {\r\n                        var current = \$input.typeahead(\"getActive\");\r\n                        if (current) {\r\n                            //alert(current.name +\"==\"+ \$input.val());\r\n                            // Some item from your model is active!\r\n                            if (current.name == \$input.val()) {\r\n                                //alert(\"HERE\");\r\n                                // This means the exact match is found. Use toLowerCase() if you want case insensitive match.\r\n                                ///\$(\"#customer_id\").val(current.id);\r\n                                setTimeout(function(){\r\n                                    //alert(\"sas\");\r\n                                    //alert(current.id);\r\n                                    //alert(\$(\".item_id_\"+current.id).length);\r\n                                    if(\$(\".check_uniq_\"+current.id).length==0){\r\n                                        //getAllReceiveStock(0);\r\n                                        \r\n                                        var ind = addItemToInvoice(current.id,[]);\r\n                                        \$(\"#search_by_name\").val(\"\");\r\n                                        \r\n                                        //updateOtherInfo(ind);\r\n                                        //\$(\"#item_id_\"+ind).val(current.id);\r\n                                        \r\n                                    }\r\n                                    \r\n                                },100);\r\n           \r\n                            }else{\r\n                                ///\$(\"#customer_id\").val(0);\r\n                                // This means it is only a partial match, you can either add a new item\r\n                                // or take the active if you don't want new items\r\n                            }\r\n                        } else {\r\n                            ///\$(\"#customer_id\").val(0);\r\n                            // Nothing is active so it is a new value (or maybe empty value)\r\n                        }\r\n                    });\r\n\r\n                },'json')\r\n                .done(function(){\r\n                })\r\n                .fail(function() {\r\n                })\r\n                .always(function() {\r\n                });\r\n            }\r\n            \r\n            function pi_more(pi_id){\r\n                \$(\".sk-circle-layer\").show();\r\n                var option_more_type = '';\r\n                \$.getJSON(\"?r=stock&f=get_all_pi_para\", function (data) {\r\n                    \$.each(data, function (key, val) {\r\n                        option_more_type += '<option value=\"'+val.id+'\" title=\"'+val.description+'\">'+val.description+'</option>'\r\n                    });\r\n                }).done(function () {\r\n                    \$(\".sk-circle-layer\").hide();\r\n                    var modal_name = \"modal_pi_mote_modal__\";\r\n                    var modal_title = \"More\";\r\n                    var content =\r\n                    '<div class=\"modal large\" data-backdrop=\"static\" id=\"'+modal_name+'\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"payment_info__\" aria-hidden=\"true\">\\n\\\r\n                        <div class=\"modal-dialog\" role=\"document\">\\n\\\r\n                            <div class=\"modal-content\">\\n\\\r\n                                <form id=\"pi_more_form\" action=\"\" method=\"post\" enctype=\"multipart/form-data\" >\\n\\\r\n                                    <input id=\"id_to_edit\" name=\"id_to_edit\" value=\"'+pi_id+'\" type=\"hidden\" />\\n\\\r\n                                    <input id=\"id_to_edit_more\" name=\"id_to_edit_more\" value=\"0\" type=\"hidden\" />\\n\\\r\n                                    <div class=\"modal-header\">\\n\\\r\n                                        <h3 class=\"modal-title\">'+modal_title+'<i style=\"float:right;font-size:34px;\" class=\"glyphicon glyphicon-remove\" onclick=\"modal_close(\\''+modal_name+'\\')\"></i></h3>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"modal-body\">\\n\\\r\n                                        <div class=\"row\">\\n\\\r\n                                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"padding-right:5px;\">\\n\\\r\n                                                <label for=\"pi_more_value\">Value</label>\\n\\\r\n                                                <input value=\"0\" required name=\"pi_more_value\" id=\"pi_more_value\" class=\"col-md-2 form-control cleavesf\" type=\"text\" placeholder=\"\" style=\"cursor:pointer\">\\n\\\r\n                                            </div>\\n\\\r\n                                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"padding-left:5px;padding-right:5px;\">\\n\\\r\n                                                <label for=\"pi_more_value\">Type</label>\\n\\\r\n                                                <select name=\"pimore_type\" id=\"selectpicker_pimore\" class=\"form-control selectpicker\" data-size=\"10\">'+option_more_type+'</select>\\n\\\r\n                                            </div>\\n\\\r\n                                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"padding-left:5px;padding-right:5px;\">\\n\\\r\n                                                <label for=\"pi_more_value\">Apply To final cost</label>\\n\\\r\n                                                <select name=\"apply_to_items\" id=\"apply_to_items\" class=\"form-control selectpicker\" data-size=\"10\"><option selected value=\"0\" title=\"No\">No</option></select>\\n\\\r\n                                            </div>\\n\\\r\n                                            <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\" style=\"padding-left:5px;padding-right:5px;\">\\n\\\r\n                                                <label for=\"pi_more_description\">Note</label>\\n\\\r\n                                                <input value=\"\" required name=\"pi_more_description\" id=\"pi_more_description\" class=\"col-md-2 form-control\" type=\"text\" placeholder=\"\">\\n\\\r\n                                            </div>\\n\\\r\n                                            <div class=\"col-lg-2 col-md-2 col-sm-2 col-xs-2\" style=\"padding-left:5px;\">\\n\\\r\n                                                <label for=\"action_btn_\">&nbsp;</label>\\n\\\r\n                                                <button style=\"width:100%\" id=\"action_btn_m\" type=\"submit\" class=\"btn btn-primary\">Add</button>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                    <div class=\"modal-footer\" style=\" text-align: left;\">\\n\\\r\n                                        <div class=\"row\">\\n\\\r\n                                            <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">\\n\\\r\n                                                <table style=\"width:100%\" id=\"pi_more_table\" class=\"table table-striped table-bordered\" cellspacing=\"0\">\\n\\\r\n                                                    <thead>\\n\\\r\n                                                        <tr>\\n\\\r\n                                                            <th style=\"width:50px;\">ID</th>\\n\\\r\n                                                            <th style=\"width:120px;\">Type</th>\\n\\\r\n                                                            <th style=\"width:120px;\">Value</th>\\n\\\r\n                                                            <th style=\"width:120px;\">Apply To Cost</th>\\n\\\r\n                                                            <th>Note</th>\\n\\\r\n                                                            <th style=\"width:80px;\"></th>\\n\\\r\n                                                        </tr>\\n\\\r\n                                                    </thead>\\n\\\r\n                                                    <tbody></tbody>\\n\\\r\n                                                </table>\\n\\\r\n                                            </div>\\n\\\r\n                                        </div>\\n\\\r\n                                    </div>\\n\\\r\n                                </form>\\n\\\r\n                            </div>\\n\\\r\n                        </div>\\n\\\r\n                    </div>';\r\n                    \$(\"#\"+modal_name).remove();\r\n                    \$(\"body\").append(content);\r\n\r\n                    submitMorePI(pi_id);\r\n\r\n                    \$('#'+modal_name).on('show.bs.modal', function (e) {\r\n\r\n                    });\r\n\r\n                    \$('#'+modal_name).on('shown.bs.modal', function (e) {\r\n                        \$('#selectpicker_pimore').selectpicker();\r\n                        \$('#apply_to_items').selectpicker();\r\n                        \r\n                        //\$(\".mask_format\").mask(get_decimal_format(\$(\"#currency_id\").val()), {reverse: true});\r\n                        \r\n                        //pi_more_value\r\n                        \r\n                        cleaves_class(\".cleavesf\",3);\r\n                        var table_name = \"pi_more_table\";\r\n                        var _cards_table__var =null;\r\n\r\n                            var search_fields = [];\r\n                            var index = 0;\r\n                            \$('#'+table_name+' tfoot th').each( function () {\r\n                                if(jQuery.inArray(index, search_fields) !== -1){\r\n                                    var title = \$(this).text();\r\n                                    \$(this).html( '<input id=\"idf_'+index+'\" style=\"width: 100% !important;\"  class=\"form-control input-sm\" type=\"text\" placeholder=\"'+title+'\" />' );\r\n                                    index++;\r\n                                }\r\n                            });\r\n\r\n                            _cards_table__var = \$('#'+table_name).DataTable({\r\n                                ajax: {\r\n                                    url: \"?r=stock&f=get_pi_more&p0=\"+pi_id,\r\n                                    type: 'POST',\r\n                                    error:function(xhr,status,error) {\r\n                                    },\r\n                                },\r\n                                //order: [[1, 'asc']],\r\n                                responsive: true,\r\n                                orderCellsTop: true,\r\n                                scrollX: true,\r\n                                scrollY: \"55vh\",\r\n                                iDisplayLength: 100,\r\n                                aoColumnDefs: [\r\n                                    { \"targets\": [0], \"searchable\": false, \"orderable\": true,\"visible\": false },\r\n                                    { \"targets\": [1], \"searchable\": false, \"orderable\": true,\"visible\": true },\r\n                                    { \"targets\": [2], \"searchable\": false, \"orderable\": false,\"visible\": true },\r\n                                    { \"targets\": [3], \"searchable\": false, \"orderable\": false, \"visible\": true },\r\n                                    { \"targets\": [4], \"searchable\": false, \"orderable\": false, \"visible\": true },\r\n                                    { \"targets\": [5], \"searchable\": true, \"orderable\": false, \"visible\": true,\"className\": \"dt-center\"},\r\n                                ],\r\n                                scrollCollapse: true,\r\n                                paging: true,\r\n                                bPaginate: false,\r\n                                bLengthChange: false,\r\n                                bFilter: true,\r\n                                bInfo: false,\r\n                                bAutoWidth: true,\r\n                                dom: '<\"toolbar\">frtip',\r\n                                initComplete: function(settings, json) {  \r\n                                    \$(\".sk-circle-layer\").hide();\r\n                                },\r\n                                fnRowCallback: function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {\r\n                                    \$(nRow).addClass(aData[0]);\r\n                                },\r\n                                 fnDrawCallback: function(){\r\n\r\n                                    var table = \$('#'+table_name).DataTable();\r\n                                    var p = table.rows({ page: 'current' }).nodes();\r\n                                    for (var k = 0; k < p.length; k++){\r\n                                        var index = table.row(p[k]).index();\r\n                                        table.cell(index,5).data('<i class=\"glyphicon glyphicon-edit\" onclick=\"edit_pi_more(\\''+parseInt(table.cell(index, 0).data())+'\\','+pi_id+')\" style=\"font-size:18px;cursor:pointer\" ></i>&nbsp;<i class=\"glyphicon glyphicon-trash red\" onclick=\"delete_pi_more(\\''+parseInt(table.cell(index, 0).data())+'\\','+pi_id+')\" style=\"font-size:18px;cursor:pointer\" ></i>');\r\n                                    }\r\n                                 },\r\n                            });\r\n\r\n                            \$('#'+table_name).DataTable().on('mousedown',\"tr\", function ( e, dt, type, indexes ) { \r\n                                \$('.selected').removeClass(\"selected\");\r\n                                \$(this).addClass('selected');\r\n                            });\r\n\r\n\r\n                            \$('#'+table_name).on('click', 'td', function () {\r\n                                if (\$(this).index() == 4 || \$(this).index() == 5) {\r\n                                    //return false;\r\n                                }\r\n                            });\r\n\r\n                    });\r\n                    \$('#'+modal_name).on('hide.bs.modal', function (e) {\r\n                        \$(\"#\"+modal_name).remove();\r\n                    });\r\n                    \$('#'+modal_name).modal('show');\r\n                });\r\n                \r\n                \r\n            }\r\n            \r\n            \r\n            \r\n            function edit_pi_more(id,pi_id){\r\n                \$(\".sk-circle\").center();\r\n                \$(\".sk-circle-layer\").show();\r\n                \$.getJSON(\"?r=stock&f=get_pi_more_by_id&p0=\"+id+\"&p1=\"+pi_id, function (data) {\r\n                    \$(\"#pi_more_value\").val(data[0].value);\r\n                    \$(\"#pi_more_value\").trigger(\"input\");\r\n                  \r\n                    \$('#selectpicker_pimore').selectpicker('val', data[0].type_id);\r\n                    \$('#selectpicker_pimore').selectpicker('refresh');\r\n                    \r\n                    \$('#apply_to_items').selectpicker('val', data[0].apply_to_pi);\r\n                    \$('#apply_to_items').selectpicker('refresh');\r\n                    \r\n                    \$(\"#pi_more_description\").val(data[0].note);\r\n                    \r\n                    \$(\"#id_to_edit_more\").val(id);\r\n                    \r\n                    \r\n                    \$('#action_btn_m').html(\"Update\");\r\n                }).done(function () {\r\n                    \$(\".sk-circle-layer\").hide();\r\n                });\r\n            }\r\n            \r\n            function delete_pi_more(id,pi_id){       \r\n                swal({\r\n                    title: \"Are you sure?\",\r\n                    text: \"This item will be deleted\",\r\n                    type: \"warning\",\r\n                    showCancelButton: true,\r\n                    confirmButtonClass: \"btn-danger\",\r\n                    confirmButtonText: \"Yes\",\r\n                    closeOnConfirm: true,\r\n                    cancelButtonText: \"Cancel\",\r\n                },\r\n                function(isConfirm){\r\n                    if(isConfirm){\r\n                        \$(\".sk-circle\").center();\r\n                        \$(\".sk-circle-layer\").show();\r\n                        \$.getJSON(\"?r=stock&f=delete_pi_more&p0=\"+id, function (data) {\r\n\r\n                        }).done(function () {\r\n                            \$('#pi_more_table').DataTable().ajax.url(\"?r=stock&f=get_pi_more&p0=\"+pi_id).load(function () {\r\n                                \$(\".sk-circle-layer\").hide();\r\n                                calculate_invoice_more_not_applied();\r\n                            }, false);\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            \r\n            function submitMorePI(pi_id) {\r\n                \$(\"#pi_more_form\").on('submit', (function (e) {\r\n                    e.preventDefault();\r\n\r\n                    \$(\".sk-circle\").center();\r\n                    \$(\".sk-circle-layer\").show();\r\n                    \$.ajax({\r\n                        url: \"?r=stock&f=add_more_pi\",\r\n                        type: \"POST\",\r\n                        data: new FormData(this),\r\n                        contentType: false,\r\n                        cache: false,\r\n                        processData: false,\r\n                        dataType: 'json',\r\n                        success: function (data)\r\n                        { \r\n                            \$(\".sk-circle-layer\").hide();\r\n                            \r\n                            \$(\"#id_to_edit_more\").val(0);\r\n                            \r\n                            \$(\"#pi_more_value\").val(0);\r\n                            \$(\"#pi_more_value\").trigger(\"input\");\r\n                            \r\n                            \$(\"#pi_more_description\").val(\"\");\r\n                            \r\n                            \$('#action_btn_m').html(\"Add\");\r\n                                                        \r\n                            \$('#pi_more_table').DataTable().ajax.url(\"?r=stock&f=get_pi_more&p0=\"+pi_id).load(function () {\r\n                                calculate_invoice_more_not_applied();\r\n                            }, false);\r\n                        }\r\n                    });\r\n                }));\r\n            }\r\n            \r\n        </script>\r\n    </head>\r\n    <body>\r\n        \r\n        ";
include "application/mvc/views/topMenu.php";
echo "        <div class=\"container\" >\r\n            <div class=\"panel panel-default\">\r\n                <div class=\"panel-body\" style=\"margin-top: 40px;\">\r\n                    <div class=\"row\">\r\n                        <div class=\"col-lg-12\" >           \r\n                            <table id=\"stock_invoices\" class=\"table table-striped table-bordered \" cellspacing=\"0\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th style=\"width: 60px;\">Invoice ID</th>\r\n                                        <th style=\"width: 90px;\">Invoice Date</th>\r\n                                        <th >Supplier</th>\r\n                                        <th style=\"width: 100px;\">Subtotal</th>\r\n                                        <th style=\"width: 80px;\">Discount</th>\r\n                                        <th style=\"width: 100px;\">Total VAT</th> \r\n                                        <th style=\"width: 100px;\">Total</th> \r\n                                        <th style=\"width: 100px;\">Total QTY</th> \r\n                                        <th style=\"width: 120px;\">Sup. Invoice ref.</th> \r\n                                        \r\n                                        <th style=\"width: 70px;\">Rates</th> \r\n                                        <th style=\"width: 120px;\"></th> \r\n                                        <th style=\"width: 35px;\"></th> \r\n                                        <th style=\"width: 35px;\"></th> \r\n                                    </tr>\r\n                                </thead>\r\n                                <tfoot>\r\n                                    <tr>\r\n                                        <th>Invoice ID</th>\r\n                                        <th>Invoice Date</th>\r\n                                         <th>Supplier</th>\r\n                                        <th>Subtotal</th>\r\n                                        <th>Discount</th>\r\n                                        <th>Total VAT</th>\r\n                                        <th>Total</th>\r\n                                        <th>Total QTY</th>\r\n                                        <th>Sup. Invoice ref.</th>\r\n                                        <th>Rate</th>\r\n                                        <th></th>\r\n                                        <th></th>\r\n                                        <th></th>\r\n                                    </tr>\r\n                                </tfoot>\r\n                                <tbody></tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"sk-circle-layer\">\r\n            <div class=\"sk-circle\">\r\n                <div class=\"sk-circle1 sk-child\"></div>\r\n                <div class=\"sk-circle2 sk-child\"></div>\r\n                <div class=\"sk-circle3 sk-child\"></div>\r\n                <div class=\"sk-circle4 sk-child\"></div>\r\n                <div class=\"sk-circle5 sk-child\"></div>\r\n                <div class=\"sk-circle6 sk-child\"></div>\r\n                <div class=\"sk-circle7 sk-child\"></div>\r\n                <div class=\"sk-circle8 sk-child\"></div>\r\n                <div class=\"sk-circle9 sk-child\"></div>\r\n                <div class=\"sk-circle10 sk-child\"></div>\r\n                <div class=\"sk-circle11 sk-child\"></div>\r\n                <div class=\"sk-circle12 sk-child\"></div>\r\n            </div>\r\n        </div>\r\n    </body>\r\n</html>\r\n\r\n";

?>