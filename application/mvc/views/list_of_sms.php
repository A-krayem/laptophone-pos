<?php
/*
 * @ https://EasyToYou.eu - IonCube v11 Decoder Online
 * @ PHP 5.6
 * @ Decoder version: 1.0.4
 * @ Release: 02/06/2020
 *
 * @ ZendGuard Decoder PHP 5.6
 */

// Decoded file for php version 53.
echo "<!DOCTYPE html>\n<!--\nTo change this license header, choose License Headers in Project Properties.\nTo change this template file, choose Tools | Templates\nand open the template in the editor.\n-->\n<html>\n    <head>\n        <title>";
echo $_SESSION["page_title"];
echo " SMS</title>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <link rel=\"icon\" type=\"image/png\" href=\"resources/favicon.png\">\n        \n        <script src=\"libraries/jquery-3.1.1.min.js\" type=\"text/javascript\"></script>\n\n        <script src=\"libraries/bootstrap-3.3.7-dist/js/bootstrap.min.js\" type=\"text/javascript\"></script>\n        <link href=\"libraries/bootstrap-3.3.7-dist/css/bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n        <script src=\"libraries/bootstrap-plugins/DataTables-1.10.13/media/js/jquery.dataTables.min.js\" type=\"text/javascript\"></script>\n        <script src=\"libraries/bootstrap-plugins/DataTables-1.10.13/media/js/dataTables.bootstrap.min.js\" type=\"text/javascript\"></script>\n        <link href=\"libraries/bootstrap-plugins/DataTables-1.10.13/media/css/dataTables.bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n\n        <script src=\"libraries/bootstrap-plugins/DataTables-1.10.13/extensions/Select/js/dataTables.select.min.js\" type=\"text/javascript\"></script>\n\n        <script src=\"libraries/bootstrap-plugins/Buttons-1.2.4/js/dataTables.buttons.min.js\" type=\"text/javascript\"></script>\n        \n        <script src=\"libraries/bootstrap-plugins/Buttons-1.2.4/js/buttons.bootstrap.min.js\" type=\"text/javascript\"></script>\n        <link href=\"libraries/bootstrap-plugins/Buttons-1.2.4/css/buttons.bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n        \n        <script src=\"application/mvc/views/custom_libraries/javascripts/global_functions.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\n        <script src=\"application/mvc/views/custom_libraries/javascripts/global.js?rnd=";
echo self::generateRandomStringComplex();
echo "\" type=\"text/javascript\"></script>\n\n        <script src=\"libraries/bootstrap-plugins/bootstrap-select-master/bootstrap-select-master/dist/js/bootstrap-select.min.js\" type=\"text/javascript\"></script>\n        <link href=\"libraries/bootstrap-plugins/bootstrap-select-master/bootstrap-select-master/dist/css/bootstrap-select.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n        <link href=\"application/mvc/views/custom_libraries/css/global.css?rnd=";
echo self::generateRandomStringComplex();
echo "\" rel=\"stylesheet\" type=\"text/css\"/>\n        \n        <script src=\"libraries/bootstrap-plugins/libs/bootstrap-confirmation.min.js\" type=\"text/javascript\"></script>\n        \n        <script src=\"libraries/bootstrap-plugins/bootstrap-sweetalert-master/dist/sweetalert.min.js\" type=\"text/javascript\"></script>\n        <link href=\"libraries/bootstrap-plugins/bootstrap-sweetalert-master/dist/sweetalert.css\" rel=\"stylesheet\" type=\"text/css\"/>\n        \n        \n             <link href=\"libraries/bootstrap-plugins/datepicker-master/dist/css/bootstrap-datepicker.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n        <script src=\"libraries/bootstrap-plugins/datepicker-master/dist/js/bootstrap-datepicker.min.js\" type=\"text/javascript\"></script>\n        \n        <script src=\"libraries/bootstrap-plugins/daterangepicker-master/moment.min.js\" type=\"text/javascript\"></script>\n        <script src=\"libraries/bootstrap-plugins/bootstrap-datetimepicker-master/build/js/bootstrap-datetimepicker.min.js\" type=\"text/javascript\"></script>\n        <link href=\"libraries/bootstrap-plugins/bootstrap-datetimepicker-master/build/css/bootstrap-datetimepicker.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n        \n        \n       <link href=\"application/mvc/views/custom_libraries/svgs/font/style.css?rnd=";
echo self::generateRandomStringComplex();
echo "\" rel=\"stylesheet\" type=\"text/css\"/>\n        <script src=\"libraries/cleave.js-master/dist/cleave.min.js\" type=\"text/javascript\"></script>\n        <style type=\"text/css\">\n            \n            .container,.panel {\n                height:100%;\n                width: 100%;\n                padding: 0px !important;\n                margin: 0px !important;\n            }\n\n            \n            .table>tfoot>tr>th{\n                font-size: 12px !important;\n                background-color: #F3F3F3;\n                padding: 2px;\n                border: none !important;\n            }\n            \n            .dataTables_filter { display: none; }\n            \n            .input-sm{\n                height: 25px !important;\n            }\n            \n            .selected{\n                background-color: #337ab7 !important;\n                color: #ffffff !important;\n            }\n            \n            .search_filter{\n                width: 100% !important;\n                color: #000;\n            }\n            \n            \n            ::-webkit-input-placeholder { /* Chrome/Opera/Safari */\n                color: #337ab7;\n                opacity: 0.9;\n            }\n            ::-moz-placeholder { /* Firefox 19+ */\n                color: #337ab7;\n                opacity: 0.9;\n            }\n            :-ms-input-placeholder { /* IE 10+ */\n                color: #337ab7;\n                opacity: 0.9;\n            }\n            :-moz-placeholder { /* Firefox 18- */\n                color: #337ab7;\n                opacity: 0.9;\n            }\n            \n            /* enable absolute positioning */\n            .inner-addon { \n                position: relative; \n            }\n\n            /* style icon */\n            .inner-addon .glyphicon {\n              position: absolute;\n              padding: 6px;\n              pointer-events: none;\n            }\n\n            /* align icon */\n            .left-addon .glyphicon  { left:  0px;}\n            .right-addon .glyphicon { right: 0px;}\n\n            /* add padding  */\n            .left-addon input  { padding-left:  20px; }\n            .right-addon input { padding-right: 30px; }\n            \n            .phone-input{\n                    margin-bottom:8px;\n            }\n            \n            .confirmation {\n                width: 160px;\n            }\n            \n            .list-group-item{\n                border: none !important;\n            }\n            \n            div.toolbar h3{\n                margin-top: 0px !important;\n            }\n            \n            .dataTable>tfoot>tr>th{\n                /* width: 50px !important; */\n            }\n            .addon_item_icon input{\n                padding-left: 30px !important;\n            }\n            \n            .dt-center{\n                text-align: center !important;\n            }\n            \n            .sent{\n                color: #009900;\n            }\n            .failed{\n                color: #D23600;\n            }\n        </style>\n\n        <script type=\"text/javascript\">\n            \n            var sms_balance = \"";
echo $data["sms_balance"];
echo "\";\n            \n            \$(document).ready(function () {\n                //\$(\".sk-circle\").center();\n                init_table();\n            });\n            \n            function collected_nb(){\n                var _data = [];\n                \$.getJSON(\"?r=sms&f=collected_nb\", function (data) {\n                    _data = data;\n                }).done(function () {\n                    \$(\"#collected_nb\").html(_data);       \n                });\n            }\n            \n            function collect_customers(){\n                \$(\".sk-circle\").center();\n                \$(\".sk-circle-layer\").show();\n                \$.getJSON(\"?r=all_stores_data&f=collect_customers\", function (data) {\n                    \n                }).done(function () {\n                    \$(\".sk-circle-layer\").hide();\n                    collected_nb();\n                    /*\n                    \$('#list_of_sms').DataTable().ajax.url(\"?r=sms&f=getAllSms&p0=0&p1=0&p2=0&p3=0&p4=0\").load(function () {\n                        \n                        \n                    }, false);*/\n                            \n                });\n            }\n            \n            function init_table(){\n                \$('#list_of_sms').show();\n                \n                \$(\".sk-circle\").center();\n                \$(\".sk-circle-layer\").show();\n                \n                var search_fields = [0,1,2,3,4,5,6,7];\n                var index = 0;\n                \$('#list_of_sms tfoot th').each( function () {\n                    \n                    if(jQuery.inArray(index, search_fields) !== -1){\n                        var title = \$(this).text();\n                        \$(this).html( '<div class=\"inner-addon left-addon\"><input id=\"idf_'+index+'\" style=\"width: 100% !important;\"  class=\"form-control input-sm\" type=\"text\" placeholder=\"'+title+'\" /></div>' );\n                        index++;\n                    }\n                });\n                \n                items_table = \$('#list_of_sms').dataTable({\n                    ajax: \"?r=sms&f=getAllSms&p0=0&p1=0&p2=0&p3=0&p4=0\",\n                    orderCellsTop: true,\n                    bLengthChange: true,\n                    deferRender: true,\n                    iDisplayLength: 300,\n                    aoColumnDefs: [\n                        { \"targets\": [0], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [1], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [2], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [3], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [4], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [5], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [6], \"searchable\": true, \"orderable\": true, \"visible\": false},\n                        { \"targets\": [7], \"searchable\": true, \"orderable\": true, \"visible\": true},\n                        { \"targets\": [8], \"searchable\": true, \"orderable\": false, \"visible\": true},\n                    ],\n                    scrollY: '44vh',\n                    scrollCollapse: true,\n                    paging: true,\n                    order: [[ 0, \"asc\" ]],\n                    dom: '<\"toolbar\">frtip',\n                    initComplete: function( settings ) {\n                        var table = \$('#list_of_sms').DataTable();\n                        table.row(':eq(0)', { page: 'current' }).select();\n                         \n                        \$(\"div.toolbar\").html('\\n\\\n                        <div class=\"row\">\\n\\\n                            <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                    <h3><i class=\"glyphicon glyphicon-envelope\"></i>&nbsp;List of SMS</h3>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                            <div class=\"col-lg-8 col-md-8 col-xs-8\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                <div style=\"width:100%;font-size:23px;text-align:center;\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                    Remaining Balance: <b id=\"blance\">'+sms_balance+'</b>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                            <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                   &nbsp;\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                        </div>\\n\\\n                        <div class=\"row\">\\n\\\n                            <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                    <button style=\"width:100%\" onclick=\"add_new_sms([],0)\" type=\"button\" class=\"btn btn-default \"><i class=\"glyphicon glyphicon-plus\"></i>&nbsp;&nbsp;Add New SMS</button>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                            <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                    <button style=\"width:100%\" onclick=\"collect_customers()\" type=\"button\" class=\"btn btn-default \"><i class=\"glyphicon glyphicon-retweet\"></i>&nbsp;&nbsp;Collect Customers (<span id=\"collected_nb\">0</span>)</button>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                            <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;display:block\">\\n\\\n                                <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                    <button style=\"width:100%\" onclick=\"export_txt()\" type=\"button\" class=\"btn btn-default\">Export TXT</button>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                        </div>\\n\\\n                        ');\n                         \n                        collected_nb();\n                        \$(\".sk-circle-layer\").hide();\n                    },\n                    fnRowCallback: function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {\n                        \$(nRow).addClass(aData[0]);\n                    },\n                    fnDrawCallback: setOptions,\n                });\n                \n                \$('#list_of_sms').on( 'page.dt', function () {\n                });\n                \n                \n                \$('#list_of_sms').DataTable().on('mousedown',\"tr\", function ( e, dt, type, indexes ) { \n                    \$('.selected').removeClass(\"selected\");\n                    \$(this).addClass('selected');\n                });\n              \n                \$('#list_of_sms').DataTable().columns().every( function () {\n                    var that = this;\n                    \$( 'input', this.footer() ).on( 'keyup change', function () {\n                        \$('.selected').removeClass(\"selected\");\n                        if(\$(\".tab_toolbar button.blueB\").hasClass(\"disabled\")==false){\n                            \$(\".tab_toolbar button.blueB\").addClass(\"disabled\");\n                        }\n                        \n                        if(that.index()==2){\n                            search_barcode_in_datatable(this.value,that.index(),100);\n                        }else{\n                            search_barcode_in_datatable(this.value,that.index(),100);\n                        }\n                    } );\n                } );\n            }\n            \n            var tmo = null;\n            function search_barcode_in_datatable(val,index,delay){\n                clearTimeout(tmo);\n                tmo = setTimeout(function(){\n                    \$('#list_of_sms').DataTable()\n                        .columns(index)\n                        .search(val)\n                        .draw();\n                },delay); \n            }\n            \n            function setOptions(){\n                var table = \$('#list_of_sms').DataTable();\n                var p = table.rows({ page: 'current' }).nodes();\n\n                for (var k = 0; k < p.length; k++){\n                    var index = table.row(p[k]).index();\n                    table.cell(index, 8).data('<i title=\"Customers\" class=\"glyphicon glyphicon-user glyphicon_size\" onclick=\"show_list_of_users_to_send('+table.cell(index, 0).data()+')\" style=\"cursor:pointer\"></i>&nbsp;<i onclick=\"edit_sms('+table.cell(index, 0).data()+')\" title=\"Delete\" class=\"glyphicon glyphicon-edit glyphicon_size\" style=\"cursor:pointer\"></i>&nbsp;&nbsp;<i title=\"Test\" class=\"glyphicon glyphicon-envelope\" onclick=\"test_sms('+table.cell(index, 0).data()+')\" style=\"cursor:pointer\"></i>&nbsp;&nbsp;<i title=\"Delete\" class=\"glyphicon glyphicon-trash glyphicon_size red\" onclick=\"delete_sms('+table.cell(index, 0).data()+')\" style=\"cursor:pointer\"></i>');\n                }\n            }\n            \n            jQuery.fn.putCursorAtEnd = function() {\n\n                return this.each(function() {\n\n                  // Cache references\n                  var \$el = \$(this),\n                      el = this;\n\n                  // Only focus if input isn't already\n                  if (!\$el.is(\":focus\")) {\n                   \$el.focus();\n                  }\n\n                  // If this function exists... (IE 9+)\n                  if (el.setSelectionRange) {\n\n                    // Double the length because Opera is inconsistent about whether a carriage return is one character or two.\n                    var len = \$el.val().length * 2;\n\n                    // Timeout seems to be required for Blink\n                    setTimeout(function() {\n                      el.setSelectionRange(len, len);\n                    }, 1);\n\n                  } else {\n\n                    // As a fallback, replace the contents with itself\n                    // Doesn't work in Chrome, but Chrome supports setSelectionRange\n                    \$el.val(\$el.val());\n\n                  }\n\n                  // Scroll to the bottom, in case we're in a tall textarea\n                  // (Necessary for Firefox and Chrome)\n                  this.scrollTop = 999999;\n\n                });\n\n              };\n\n            function test_sms(sms_id){\n                swal({\n                    title: \"Send SMS Test?\",\n                    html: true ,\n                    text: '<input style=\"z-index:999999999999\" class=\"form-control\" value=\"961\" type=\"text\" id=\"pnumber\"/>',\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonClass: \"btn-danger\",\n                    confirmButtonText: \"Send\",\n                    cancelButtonText: \"Cancel\",\n                    closeOnConfirm: true\n                  },\n                function(isconfirm){\n                    if(isconfirm){\n                        var _data = [];\n                        \$.getJSON(\"?r=sms&f=send_test&p0=\"+sms_id+\"&p1=\"+\$(\"#pnumber\").val(), function (data) {\n                            _data = data;\n                        }).done(function () {\n                            if(_data[0]==-1){\n                                \$(\".sk-circle-layer\").hide();\n                                swal(\"Check your internet connection\");\n                                return;\n                            }else{\n                                \$(\"#blance\").html(_data[0].balance);\n                                //var dt = \$('#list_of_sms').DataTable();\n                                //dt.row('.selected').remove().draw(false);\n                            }\n                            \n                        });\n                    }\n                });\n                \n                setTimeout(function(){\n                    var searchInput = \$(\"#pnumber\");\n                    searchInput.putCursorAtEnd()\n                        .on(\"focus\", function() {\n                            searchInput.putCursorAtEnd();\n                        });\n                    \$(\"#pnumber\").focus();    \n                },300);\n            }\n            \n            function delete_sms(id){\n                swal({\n                    title: \"Are you sure?\",\n                    text: \"\",\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonClass: \"btn-danger\",\n                    confirmButtonText: \"Delete It.\",\n                    cancelButtonText: \"Cancel\",\n                    closeOnConfirm: true\n                  },\n                function(isconfirm){\n                    if(isconfirm){\n\n                        \$.getJSON(\"?r=sms&f=delete_sms&p0=\"+id, function (data) {\n\n                        }).done(function () {\n                            var dt = \$('#list_of_sms').DataTable();\n                            dt.row('.selected').remove().draw(false);\n                        });\n                    }\n                });\n            }\n            \n            function edit_sms(id){\n                \$(\".sk-circle\").center();\n                \$(\".sk-circle-layer\").show();\n                var _data = [];\n                \$.getJSON(\"?r=sms&f=get_sms_by_id&p0=\"+id, function (data) {\n                    _data = data;\n                }).done(function () {\n                    add_new_sms(_data,id);\n                });\n            }\n            \n            function export_txt(){\n                \$(\".sk-circle\").center();\n                \$(\".sk-circle-layer\").show();\n                var _data = [];\n                \$.getJSON(\"?r=sms&f=get_all_txt\", function (data) {\n                    _data = data;\n                }).done(function () {\n                    var modal_name = \"export_txt\";\n                    var content =\n                    '<div class=\"modal large\" id=\"'+modal_name+'\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"payment_info__\" aria-hidden=\"true\">\\n\\\n                        <div class=\"modal-dialog\" role=\"document\">\\n\\\n                            <div class=\"modal-content\">\\n\\\n                                <div class=\"modal-body\">\\n\\\n                                    <div class=\"row\">\\n\\\n                                        <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">\\n\\\n                                            <textarea class=\"form-control\" rows=\"20\">'+_data.txt+'</textarea>\\n\\\n                                        </div>\\n\\\n                                    </div>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                        </div>\\n\\\n                    </div>';\n                    \$(\"#\"+modal_name).remove();\n                    \$(\"body\").append(content);\n\n                    \$('#'+modal_name).on('shown.bs.modal', function (e) {\n                        \$(\".sk-circle-layer\").hide();\n                    });\n\n                    \$('#'+modal_name).on('show.bs.modal', function (e) {\n\n                    });\n                    \$('#'+modal_name).on('hide.bs.modal', function (e) {\n                        \$(\"#\"+modal_name).remove();\n                    });\n                    \$('#'+modal_name).modal('show');\n                });\n            }\n            \n            function add_new_sms(data,id){\n                var modal_name = \"add_sms_info\";\n                var modal_title = \"Add new SMS\";\n\n                var content =\n                '<div class=\"modal large\" data-backdrop=\"static\" id=\"'+modal_name+'\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"payment_info__\" aria-hidden=\"true\">\\n\\\n                    <div class=\"modal-dialog\" role=\"document\">\\n\\\n                        <div class=\"modal-content\">\\n\\\n                            <form id=\"sms_form\" action=\"\" method=\"post\" enctype=\"multipart/form-data\" >\\n\\\n                                <input name=\"id_to_edit\" id=\"id_to_edit\" value=\"'+id+'\" type=\"hidden\" />\\n\\\n                                <div class=\"modal-header\"> \\n\\\n                                    <h3 class=\"modal-title\">'+modal_title+'<i style=\"float:right;font-size:34px;\" class=\"glyphicon glyphicon-remove\" onclick=\"modal_close(\\''+modal_name+'\\')\"></i></h3>\\n\\\n                                </div>\\n\\\n                                <div class=\"modal-body\">\\n\\\n                                    <div class=\"row\">\\n\\\n                                        <div class=\"col-lg-4 col-md-4 col-sm-4 col-xs-4\">\\n\\\n                                            <label for=\"title\">SMS Title</label>\\n\\\n                                            <input required name=\"sms_title\" id=\"sms_title\" class=\"col-md-2 form-control\" type=\"text\" placeholder=\"\">\\n\\\n                                        </div>\\n\\\n                                        <div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-3\" style=\"display:none\">\\n\\\n                                            <label for=\"sms_start\">Start Date</label>\\n\\\n                                            <input required name=\"sms_start\" id=\"sms_start\" class=\"form-control\" type=\"text\" placeholder=\"\">\\n\\\n                                        </div>\\n\\\n                                    </div>\\n\\\n                                    <div class=\"row\">\\n\\\n                                        <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">\\n\\\n                                            <label for=\"title\">SMS Body (<span id=\"sms_nb_letter\">160</span>)</label>\\n\\\n                                            <textarea required name=\"sms_body\" id=\"sms_body\" class=\"form-control\" type=\"text\" placeholder=\"\" oninput=\"count_body_char()\"></textarea>\\n\\\n                                        </div>\\n\\\n                                    </div>\\n\\\n                                </div>\\n\\\n                                <div class=\"modal-footer\">\\n\\\n                                    <button id=\"action_btn_\" type=\"submit\" class=\"btn btn-primary\">Add</button>\\n\\\n                                </div>\\n\\\n                            </form>\\n\\\n                        </div>\\n\\\n                    </div>\\n\\\n                </div>';\n                \$(\"#\"+modal_name).remove();\n                \$(\"body\").append(content);\n                \n                submitSMS(modal_name);\n\n                \$('#'+modal_name).on('shown.bs.modal', function (e) {\n                    \n                    if(data.length>0){\n                        \$(\"#sms_title\").val(data[0].title);\n                        \$(\"#sms_body\").val(data[0].body);\n                                                \n                        \$('#sms_start').datetimepicker({\n                            defaultDate: data[0].start_date,\n                            format: 'YYYY-MM-DD HH:mm:ss'\n                        });\n                        \n                        count_body_char();\n                        \n                        \$('#action_btn_').html(\"Update\");\n                        \n                    }else{\n                        \$('#sms_start').datetimepicker({\n                            format: 'YYYY-MM-DD HH:mm:ss',\n                        });\n                        \$('#sms_start').data(\"DateTimePicker\").date(moment(new Date()).format('YYYY-MM-DD HH:mm:ss'));\n                    }\n                    \n                    \$('#sms_start').datetimepicker().on('changeDate', function(ev) {\n\n                    }).on('hide show', function(event) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                    });\n                    \n                    \$(\".sk-circle-layer\").hide();\n        \n                });\n\n                \$('#'+modal_name).on('show.bs.modal', function (e) {\n                    //\$(\n                });\n                \$('#'+modal_name).on('hide.bs.modal', function (e) {\n                    \$(\"#\"+modal_name).remove();\n                });\n                \$('#'+modal_name).modal('show');\n            }\n            \n            function submitSMS(modal_name){\n                \$(\"#sms_form\").on('submit', (function (e) {\n                    e.preventDefault();\n                    \$(\".sk-circle\").center();\n                    \$(\".sk-circle-layer\").show();\n                    \$.ajax({\n                        url: \"?r=sms&f=add_new_sms\",\n                        type: \"POST\",\n                        data: new FormData(this),\n                        contentType: false,\n                        cache: false,\n                        processData: false,\n                        dataType: 'json',\n                        success: function (data)\n                        { \n                            \$('#'+modal_name).modal('hide');\n                            \n                            \$('#list_of_sms').DataTable().ajax.url(\"?r=sms&f=getAllSms&p0=0&p1=0&p2=0&p3=0&p4=0\").load(function () {\n                                \$(\"#list_of_sms\").DataTable().page('last').draw('page');\n                                \$(\".\"+data).addClass(\"selected\");\n                                \$('body .dataTables_scrollBody').animate({\n\n                                    scrollTop: \$(\".\"+data).position().top\n                                }, 500);\n                            }, false);\n\n                            \$(\".sk-circle-layer\").hide();\n                        }\n                    });\n                }));\n            }\n\n            function count_body_char(){\n                var arabic = /[\\u0600-\\u06FF]/;\n                var string = \$(\"#sms_body\").val(); // some Arabic string from Wikipedia\n                \n                var max = 170;\n                if(arabic.test(string)){\n                    max = 70;\n                }\n                \n                //if(\$(object).val().length<=max){\n                \$(\"#sms_nb_letter\").html(\$(\"#sms_body\").val().length+\" Character = \"+(Math.floor(\$(\"#sms_body\").val().length/max)+1)+\" SMS\");\n                //}\n                \n                \n            }\n            \n            function show_list_of_users_to_send(sms_id){\n                var modal_name = \"list_of_users_to_send\";\n                var modal_title = \"List of Cutomers\";\n\n                var content =\n                '<div class=\"modal medium\" data-backdrop=\"static\" id=\"'+modal_name+'\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"payment_info__\" aria-hidden=\"true\">\\n\\\n                    <div class=\"modal-dialog\" role=\"document\">\\n\\\n                        <div class=\"modal-content\">\\n\\\n                            <input type=\"hidden\" id=\"sms_id\" name=\"sms_id\" value=\"'+sms_id+'\" />\\n\\\n                            <div class=\"modal-header\"> \\n\\\n                                <h3 class=\"modal-title\">'+modal_title+'<i style=\"float:right;font-size:34px;\" class=\"glyphicon glyphicon-remove\" onclick=\"modal_close(\\''+modal_name+'\\')\"></i></h3>\\n\\\n                            </div>\\n\\\n                            <div class=\"modal-body\">\\n\\\n                                <div class=\"row\">\\n\\\n                                    <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">\\n\\\n                                        <table style=\"width:100%\" id=\"list_of_customer_sms\" class=\"table table-striped table-bordered\" cellspacing=\"0\">\\n\\\n                                            <thead>\\n\\\n                                                <tr>\\n\\\n                                                    <th >ID</th>\\n\\\n                                                    <th >Name</th>\\n\\\n                                                    <th style=\"width:90px;\">Phone</th>\\n\\\n                                                    <th style=\"width:60px;\">Status</th>\\n\\\n                                                    <th style=\"width:120px;\">Sent Date</th>\\n\\\n                                                    <th style=\"width:60px;\">Excluded</th>\\n\\\n                                                    <th style=\"width:20px;\">&nbsp;</th>\\n\\\n                                                </tr>\\n\\\n                                            </thead>\\n\\\n                                            <tbody></tbody>\\n\\\n                                            <tfoot>\\n\\\n                                                <tr>\\n\\\n                                                    <th >ID</th>\\n\\\n                                                    <th >Name</th>\\n\\\n                                                    <th>Phone</th>\\n\\\n                                                    <th>Status</th>\\n\\\n                                                    <th>Sent Date</th>\\n\\\n                                                    <th>Excluded</th>\\n\\\n                                                    <th>&nbsp;</th>\\n\\\n                                                </tr>\\n\\\n                                            </tfoor>\\n\\\n                                        </table>\\n\\\n                                    </div>\\n\\\n                                </div>\\n\\\n                            </div>\\n\\\n                        </div>\\n\\\n                    </div>\\n\\\n                </div>';\n                \$(\"#\"+modal_name).remove();\n                \$(\"body\").append(content);\n                \n                \$('#'+modal_name).on('shown.bs.modal', function (e) {        \n                    var table_name = \"list_of_customer_sms\";\n                    var _cards_table__var =null;\n\n                        var search_fields = [0,1,2,3,4];\n                        var index = 0;\n                        \$('#'+table_name+' tfoot th').each( function () {\n                            if(jQuery.inArray(index, search_fields) !== -1){\n                                var title = \$(this).text();\n                                \$(this).html( '<input id=\"idf_'+index+'\" style=\"width: 100% !important;\"  class=\"form-control input-sm\" type=\"text\" placeholder=\"'+title+'\" />' );\n                                index++;\n                            }\n                        });\n                        \n                        var _total_sent = 0;\n                        var _total_failed = 0;\n                        var _total_pending = 0;\n\n                        _cards_table__var = \$('#'+table_name).DataTable({\n                            ajax: {\n                                url: \"?r=sms&f=list_of_customer&p0=\"+sms_id+\"&p1=1&p2=0\",\n                                type: 'POST',\n                                error:function(xhr,status,error) {\n                                },\n                                dataSrc: function (json) {\n                                    _total_sent = json._total_sent;\n                                    _total_failed = json._total_failed;\n                                    _total_pending = json._total_pending;\n                                    \n                                    \$(\"#_total_sent\").html(\"Sent (\"+_total_sent+\")\");\n                                    \$(\"#_total_failed\").html(\"Failed (\"+_total_failed+\")\");\n                                    \$(\"#_total_pending\").html(\"Pending (\"+_total_pending+\")\");\n                                \n                                    return json.data;\n                                 }\n                            },\n                            responsive: true,\n                            orderCellsTop: true,\n                            scrollX: true,\n                            scrollY: \"55vh\",\n                            iDisplayLength: 500,\n                            aoColumnDefs: [\n                                { \"targets\": [0], \"searchable\": true, \"orderable\": true,\"visible\": false },\n                                { \"targets\": [1], \"searchable\": true, \"orderable\": true,\"visible\": true },\n                                { \"targets\": [2], \"searchable\": true, \"orderable\": true, \"visible\": true },\n                                { \"targets\": [3], \"searchable\": true, \"orderable\": true,\"visible\": true,\"className\": \"dt-center\" },\n                                { \"targets\": [4], \"searchable\": true, \"orderable\": true,\"visible\": true },\n                                { \"targets\": [5], \"searchable\": true, \"orderable\": true,\"visible\": false },\n                                { \"targets\": [6], \"searchable\": true, \"orderable\": true,\"visible\": true,\"className\": \"dt-center\" },\n                            ],\n                            scrollCollapse: true,\n                            paging: true,\n                            bPaginate: false,\n                            bLengthChange: false,\n                            bFilter: true,\n                            bSort: false,\n                            bInfo: false,\n                            bAutoWidth: true,\n                            dom: '<\"toolbar1\">frtip',\n                            initComplete: function(settings, json) { \n                                \$(\"div.toolbar1\").html('\\n\\\n                                    <div class=\"row\">\\n\\\n                                        <div class=\"col-lg-3 col-md-3 col-xs-3\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                            <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                                <button style=\"width:100%\" onclick=\"start_sending()\" type=\"button\" class=\"btn btn-default \">Start Sending</button>\\n\\\n                                            </div>\\n\\\n                                        </div>\\n\\\n                                        <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                            <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                                <button style=\"width:100%\" type=\"button\" class=\"btn btn-default\" id=\"_total_pending\"></button>\\n\\\n                                            </div>\\n\\\n                                        </div>\\n\\\n                                        <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                            <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                                <button style=\"width:100%\" type=\"button\" class=\"btn btn-default\" id=\"_total_sent\"></button>\\n\\\n                                            </div>\\n\\\n                                        </div>\\n\\\n                                        <div class=\"col-lg-2 col-md-2 col-xs-2\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                            <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                                <button style=\"width:100%\" type=\"button\" class=\"btn btn-default\" id=\"_total_failed\"></button>\\n\\\n                                            </div>\\n\\\n                                        </div>\\n\\\n                                        <div class=\"col-lg-3 col-md-3 col-xs-3\" style=\"padding-left:15px;padding-right:5px;\">\\n\\\n                                            <div style=\"width:100%\" class=\"btn-group\" role=\"group\" aria-label=\"\">\\n\\\n                                            </div>\\n\\\n                                        </div>\\n\\\n                                    </div>\\n\\\n                                ');\n        \n                                \$(\"#_total_sent\").html(\"Sent (\"+_total_sent+\")\");\n                                    \$(\"#_total_failed\").html(\"Failed (\"+_total_failed+\")\");\n                                    \$(\"#_total_pending\").html(\"Pending (\"+_total_pending+\")\");\n                                    \n                                \$(\".sk-circle-layer\").hide();\n                            },\n                            fnRowCallback: function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {\n                                \$(nRow).addClass(aData[0]);\n                            },\n                             fnDrawCallback: function(){\n                                \n                                var table = \$('#'+table_name).DataTable();\n                                var p = table.rows({ page: 'current' }).nodes();\n                                for (var k = 0; k < p.length; k++){\n                                    var index = table.row(p[k]).index();\n                                    if(table.cell(index,5).data()!=-1){\n                                        if(table.cell(index,5).data()==0){\n                                            table.cell(index,6).data('<i title=\"Exclude\" class=\"glyphicon glyphicon-trash\" onclick=\"exclude(\\''+parseInt(table.cell(index, 0).data())+'\\',1,'+sms_id+')\" style=\"font-size:18px;cursor:pointer\" ></i>');\n                                        }else{\n                                            table.cell(index,6).data('<i title=\"Include\" class=\"glyphicon glyphicon-plus\" onclick=\"exclude(\\''+parseInt(table.cell(index, 0).data())+'\\',0,'+sms_id+')\" style=\"font-size:18px;cursor:pointer\" ></i>');\n                                        }\n                                    }\n                                }\n                             },\n                        });\n\n                        \$('#'+table_name).DataTable().on('mousedown',\"tr\", function ( e, dt, type, indexes ) { \n                            \$('#list_of_customer_sms .selected').removeClass(\"selected\");\n                            \$(this).addClass('selected');\n                        });\n\n\n                        \$('#'+table_name).on('click', 'td', function () {\n                            if (\$(this).index() == 4 || \$(this).index() == 5) {\n                                //return false;\n                            }\n                        });\n                        \n                        \$('#'+table_name).DataTable().columns().every( function () {\n                            var that = this;\n                            \$( 'input', this.footer() ).on( 'keyup change', function () {\n                                search__datatable(this.value,that.index(),100);\n                            } );\n                        } );\n                });\n\n                \$('#'+modal_name).on('show.bs.modal', function (e) {\n                    \n                });\n                \$('#'+modal_name).on('hide.bs.modal', function (e) {\n                    \$(\"#\"+modal_name).remove();\n                });\n                \$('#'+modal_name).modal('show');\n            }\n            \n            var tmo = null;\n            function search__datatable(val,index,delay){\n                clearTimeout(tmo);\n                tmo = setTimeout(function(){\n                    \$('#list_of_customer_sms').DataTable()\n                        .columns(index)\n                        .search(val)\n                        .draw();\n                },delay); \n            }\n            \n            function exclude(id,exclude,sms_id){\n                \$.getJSON(\"?r=sms&f=exclude&p0=\"+id+\"&p1=\"+exclude, function (data) {\n                    \n                }).done(function () {\n                    \$('#list_of_customer_sms').DataTable().ajax.url(\"?r=sms&f=list_of_customer&p0=\"+sms_id+\"&p1=1&p2=0\").load(function () {\n                        \$(\".\"+id).addClass(\"selected\");\n                    }, false);\n                });\n            }\n            \n            function start_sending(){\n                swal({\n                    title: \"Are you sure?\",\n                    text: \"\",\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonClass: \"btn-danger\",\n                    confirmButtonText: \"Send\",\n                    cancelButtonText: \"Cancel\",\n                    closeOnConfirm: true\n                  },\n                function(isconfirm){\n                    if(isconfirm){\n\n                        \$(\".sk-circle\").center();\n                        \$(\".sk-circle-layer\").show();\n                        var sms_id = \$(\"#sms_id\").val();\n                        var _data = [];\n                        \$.getJSON(\"?r=sms&f=start_sending&p0=\"+sms_id, function (data) {\n                            _data = data;\n                            \$(\"#blance\").html(data[0].balance);\n                        }).done(function () {\n                            if(_data[0]==-1){\n                                \$(\".sk-circle-layer\").hide();\n                                swal(\"Check your internet connection\");\n                                return;\n                            }else if(_data[0]==-2){\n                                \$(\".sk-circle-layer\").hide();\n                                swal(\"Need Configuration\");\n                                return;\n                            }else{\n                                \$('#list_of_customer_sms').DataTable().ajax.url(\"?r=sms&f=list_of_customer&p0=\"+sms_id+\"&p1=1&p2=0\").load(function () {\n                                    \$(\".sk-circle-layer\").hide();\n                                    if(_data[0]==0){\n                                        setTimeout(function(){\n                                            start_sending();\n                                        },1000);\n                                    }\n                                }, false);\n                            }\n                        });\n                    }\n                });\n            }\n        </script>\n    </head>\n    <body>\n        \n        ";
include "application/mvc/views/topMenu.php";
echo "        <div class=\"container\" >\n            <div class=\"panel panel-default\">\n                <div class=\"panel-body\" style=\"margin-top: 50px;\">\n                    <div class=\"row\">\n                        <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">\n                            <table id=\"list_of_sms\" class=\"table table-striped table-bordered\" cellspacing=\"0\">\n                                <thead>\n                                    <tr>\n                                        <th style=\"width: 20px !important;\">ID</th>\n                                        <th style=\"width: 150px !important;\">Title</th>\n                                        <th>Description</th>\n                                        <th style=\"width: 90px !important;\">Creation date</th>\n                                        <th style=\"width: 90px !important;\">Start date</th>\n                                        <th style=\"width: 60px !important;\">Customers</th>\n                                        <th style=\"width: 90px !important;\">Expected Cost</th>\n                                        \n                                        <th style=\"width: 70px !important;\">Spent</th>\n                                        <th style=\"width: 75px !important;\"></th>\n                                    </tr>\n                                </thead>\n                                <tfoot>\n                                    <tr>\n                                        <th>ID</th>\n                                        <th>Title</th>\n                                        <th>Description</th>\n                                        <th>Creation date</th>\n                                        <th>Start date</th>\n                                        <th>Customers</th>\n                                        <th>Expected Cost</th>\n                                        \n                                        <th>Spent</th>\n                                        <th></th>\n                                    </tr>\n                                </tfoot>\n                                <tbody></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \n        \n        <div class=\"sk-circle-layer\">\n            <div class=\"sk-circle\">\n                <div class=\"sk-circle1 sk-child\"></div>\n                <div class=\"sk-circle2 sk-child\"></div>\n                <div class=\"sk-circle3 sk-child\"></div>\n                <div class=\"sk-circle4 sk-child\"></div>\n                <div class=\"sk-circle5 sk-child\"></div>\n                <div class=\"sk-circle6 sk-child\"></div>\n                <div class=\"sk-circle7 sk-child\"></div>\n                <div class=\"sk-circle8 sk-child\"></div>\n                <div class=\"sk-circle9 sk-child\"></div>\n                <div class=\"sk-circle10 sk-child\"></div>\n                <div class=\"sk-circle11 sk-child\"></div>\n                <div class=\"sk-circle12 sk-child\"></div>\n            </div>\n        </div>\n    </body>\n</html>\n\n";

?>